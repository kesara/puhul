14c14
< <meta content="xml2rfc 3.9.1" name="generator">
---
> <meta content="xml2rfc 3.18.2" name="generator">
21,38c21,34
<   xml2rfc 3.9.1
<     Python 3.6.10
<     appdirs 1.4.4
<     ConfigArgParse 1.2.3
<     google-i18n-address 2.3.5
<     html5lib 1.0.1
<     intervaltree 3.0.2
<     Jinja2 2.11.2
<     kitchen 1.2.6
<     lxml 4.4.2
<     pycairo 1.19.0
<     pycountry 19.8.18
<     pyflakes 2.1.1
<     PyYAML 5.3.1
<     requests 2.22.0
<     setuptools 40.6.2
<     six 1.14.0
<     WeasyPrint 51
---
>   xml2rfc 3.18.2
>     Python 3.11.6
>     ConfigArgParse 1.7
>     google-i18n-address 3.1.0
>     intervaltree 3.1.0
>     Jinja2 3.1.2
>     lxml 4.9.3
>     platformdirs 4.1.0
>     pycountry 22.3.5
>     PyYAML 6.0.1
>     requests 2.31.0
>     setuptools 65.5.0
>     six 1.16.0
>     wcwidth 0.2.12
40c36
< <link href="rfc9043.xml" rel="alternate" type="application/rfc+xml">
---
> <link href="rfc/rfc9043.xml" rel="alternate" type="application/rfc+xml">
50c46
<   commented changes found necssary during the development of the v3
---
>   commented changes found necessary during the development of the v3
59a56,61
> :root {
>   --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
>   --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
>   --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
> }
> 
62d63
<   width: extend-to-zoom;
77c78
<   font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
---
>   font-family: var(--font-sans);
79a81
>   overflow-wrap: break-word;
165a168,176
> svg[font-family~="serif" i], svg [font-family~="serif" i] {
>   font-family: var(--font-serif);
> }
> svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
>   font-family: var(--font-sans);
> }
> svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
>   font-family: var(--font-mono);
> }
180,183d190
<   border: none;
<   /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
<      support flexbox yet.
<   */
184a192
>   border: none;
252c260,261
< a[href].selfRef {
---
> a[href].selfRef,
> .iref + a[href].internal {
262c271
< tt, code, pre, code {
---
> tt, code, pre {
264c273
<   font-family: 'Roboto Mono', monospace;
---
>   font-family: var(--font-mono);
303a313,315
> blockquote > *:last-child {
>   margin-bottom: 0;
> }
393a406,411
> /* Fix PDF info block run off issue */
> @media print {
>   #identifiers dd {
>     float: none;
>   }
> }
495c513
<   font-family: "Noto Sans",Arial,Helvetica,sans-serif;
---
>   font-family: var(--font-sans);
635d652
< 
657a675,677
>   .breakable pre {
>     break-inside: auto;
>   }
725c745
<   /* The follwing is commented out here, but set appropriately by in code, as
---
>   /* The following is commented out here, but set appropriately by in code, as
825c845
< tt, code, pre, code {
---
> tt, code, pre {
830c850
< pre.sourcecode,
---
> .sourcecode pre,
866c886
< /* Make the alternative author contact informatio look less like just another
---
> /* Make the alternative author contact information look less like just another
1047a1068
>   .artwork > pre,
1062c1083
< and increase the contrast between border and odd row background sligthtly */
---
> and increase the contrast between border and odd row background slightly */
1068a1090,1092
> tr {
>   break-inside: avoid;
> }
1088c1112
<   break-before: avoid-page;
---
>   break-before: auto;
1119c1143
< /* Text in compact lists should not get extra bottim margin space,
---
> /* Text in compact lists should not get extra bottom margin space,
1144c1168
< /* Tweak the comact list text */
---
> /* Tweak the compact list text */
1162c1186
< dd > div:first-child > pre.sourcecode,
---
> dd > div.sourcecode:first-child,
1176c1200
< li > p:last-of-type {
---
> li > p:last-of-type:only-child {
1180a1205
> <link href="https://datatracker.ietf.org/doc/draft-ietf-cellar-ffv1-20" rel="prev">
1183c1208
<   <link href="https://datatracker.ietf.org/doc/draft-ietf-cellar-ffv1-20" rel="prev">
---
>   <script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
1185,1186c1210,1211
< <body>
< <script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
---
> <body class="xml2rfc">
> <script src="metadata.min.js"></script>
1280,1282c1305,1307
< <nav class="toc"><ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.1">
<             <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
---
> <nav class="toc"><ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
>             <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
1284,1288c1309,1313
<           <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.2">
<             <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-notation-and-conventions" class="xref">Notation and Conventions</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.2.2.1">
<                 <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-definitions" class="xref">Definitions</a></p>
---
>           <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
>             <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-notation-and-conventions" class="internal xref">Notation and Conventions</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
>                 <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-definitions" class="internal xref">Definitions</a></p>
1290,1294c1315,1319
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.2.2.2">
<                 <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-conventions" class="xref">Conventions</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.2.2.2.2.1">
<                     <p id="section-toc.1-1.2.2.2.2.1.1" class="keepWithNext"><a href="#section-2.2.1" class="xref">2.2.1</a>.  <a href="#name-pseudocode" class="xref">Pseudocode</a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
>                 <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-conventions" class="internal xref">Conventions</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.1">
>                     <p id="section-toc.1-1.2.2.2.2.1.1" class="keepWithNext"><a href="#section-2.2.1" class="auto internal xref">2.2.1</a>.  <a href="#name-pseudocode" class="internal xref">Pseudocode</a></p>
1296,1297c1321,1322
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.2.2.2.2.2">
<                     <p id="section-toc.1-1.2.2.2.2.2.1"><a href="#section-2.2.2" class="xref">2.2.2</a>.  <a href="#name-arithmetic-operators" class="xref">Arithmetic Operators</a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.2">
>                     <p id="section-toc.1-1.2.2.2.2.2.1"><a href="#section-2.2.2" class="auto internal xref">2.2.2</a>.  <a href="#name-arithmetic-operators" class="internal xref">Arithmetic Operators</a></p>
1299,1300c1324,1325
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.2.2.2.2.3">
<                     <p id="section-toc.1-1.2.2.2.2.3.1"><a href="#section-2.2.3" class="xref">2.2.3</a>.  <a href="#name-assignment-operators" class="xref">Assignment Operators</a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3">
>                     <p id="section-toc.1-1.2.2.2.2.3.1"><a href="#section-2.2.3" class="auto internal xref">2.2.3</a>.  <a href="#name-assignment-operators" class="internal xref">Assignment Operators</a></p>
1302,1303c1327,1328
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.2.2.2.2.4">
<                     <p id="section-toc.1-1.2.2.2.2.4.1"><a href="#section-2.2.4" class="xref">2.2.4</a>.  <a href="#name-comparison-operators" class="xref">Comparison Operators</a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4">
>                     <p id="section-toc.1-1.2.2.2.2.4.1"><a href="#section-2.2.4" class="auto internal xref">2.2.4</a>.  <a href="#name-comparison-operators" class="internal xref">Comparison Operators</a></p>
1305,1306c1330,1331
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.2.2.2.2.5">
<                     <p id="section-toc.1-1.2.2.2.2.5.1"><a href="#section-2.2.5" class="xref">2.2.5</a>.  <a href="#name-mathematical-functions" class="xref">Mathematical Functions</a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.5">
>                     <p id="section-toc.1-1.2.2.2.2.5.1"><a href="#section-2.2.5" class="auto internal xref">2.2.5</a>.  <a href="#name-mathematical-functions" class="internal xref">Mathematical Functions</a></p>
1308,1309c1333,1334
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.2.2.2.2.6">
<                     <p id="section-toc.1-1.2.2.2.2.6.1"><a href="#section-2.2.6" class="xref">2.2.6</a>.  <a href="#name-order-of-operation-preceden" class="xref">Order of Operation Precedence</a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.6">
>                     <p id="section-toc.1-1.2.2.2.2.6.1"><a href="#section-2.2.6" class="auto internal xref">2.2.6</a>.  <a href="#name-order-of-operation-preceden" class="internal xref">Order of Operation Precedence</a></p>
1311,1312c1336,1337
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.2.2.2.2.7">
<                     <p id="section-toc.1-1.2.2.2.2.7.1"><a href="#section-2.2.7" class="xref">2.2.7</a>.  <a href="#name-range" class="xref">Range</a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.7">
>                     <p id="section-toc.1-1.2.2.2.2.7.1"><a href="#section-2.2.7" class="auto internal xref">2.2.7</a>.  <a href="#name-range" class="internal xref">Range</a></p>
1314,1315c1339,1340
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.2.2.2.2.8">
<                     <p id="section-toc.1-1.2.2.2.2.8.1"><a href="#section-2.2.8" class="xref">2.2.8</a>.  <a href="#name-numbytes" class="xref">NumBytes</a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.8">
>                     <p id="section-toc.1-1.2.2.2.2.8.1"><a href="#section-2.2.8" class="auto internal xref">2.2.8</a>.  <a href="#name-numbytes" class="internal xref">NumBytes</a></p>
1317,1318c1342,1343
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.2.2.2.2.9">
<                     <p id="section-toc.1-1.2.2.2.2.9.1"><a href="#section-2.2.9" class="xref">2.2.9</a>.  <a href="#name-bitstream-functions" class="xref">Bitstream Functions</a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.9">
>                     <p id="section-toc.1-1.2.2.2.2.9.1"><a href="#section-2.2.9" class="auto internal xref">2.2.9</a>.  <a href="#name-bitstream-functions" class="internal xref">Bitstream Functions</a></p>
1324,1337c1349,1362
<           <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3">
<             <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-sample-coding" class="xref">Sample Coding</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3.2.1">
<                 <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-border" class="xref">Border</a></p>
< </li>
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3.2.2">
<                 <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-samples" class="xref">Samples</a></p>
< </li>
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3.2.3">
<                 <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-median-predictor" class="xref">Median Predictor</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3.2.3.2.1">
<                     <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="xref">3.3.1</a>.  <a href="#name-exception" class="xref">Exception</a></p>
---
>           <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
>             <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-sample-coding" class="internal xref">Sample Coding</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
>                 <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-border" class="internal xref">Border</a></p>
> </li>
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
>                 <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-samples" class="internal xref">Samples</a></p>
> </li>
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
>                 <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-median-predictor" class="internal xref">Median Predictor</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.1">
>                     <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="auto internal xref">3.3.1</a>.  <a href="#name-exception" class="internal xref">Exception</a></p>
1341,1342c1366,1367
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3.2.4">
<                 <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-quantization-table-sets" class="xref">Quantization Table Sets</a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
>                 <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="auto internal xref">3.4</a>.  <a href="#name-quantization-table-sets" class="internal xref">Quantization Table Sets</a></p>
1344,1345c1369,1370
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3.2.5">
<                 <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="xref">3.5</a>.  <a href="#name-context" class="xref">Context</a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5">
>                 <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="auto internal xref">3.5</a>.  <a href="#name-context" class="internal xref">Context</a></p>
1347,1348c1372,1373
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3.2.6">
<                 <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="xref">3.6</a>.  <a href="#name-quantization-table-set-inde" class="xref">Quantization Table Set Indexes</a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.6">
>                 <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="auto internal xref">3.6</a>.  <a href="#name-quantization-table-set-inde" class="internal xref">Quantization Table Set Indexes</a></p>
1350,1354c1375,1379
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3.2.7">
<                 <p id="section-toc.1-1.3.2.7.1"><a href="#section-3.7" class="xref">3.7</a>.  <a href="#name-color-spaces" class="xref">Color Spaces</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3.2.7.2.1">
<                     <p id="section-toc.1-1.3.2.7.2.1.1"><a href="#section-3.7.1" class="xref">3.7.1</a>.  <a href="#name-ycbcr" class="xref">YCbCr</a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.7">
>                 <p id="section-toc.1-1.3.2.7.1"><a href="#section-3.7" class="auto internal xref">3.7</a>.  <a href="#name-color-spaces" class="internal xref">Color Spaces</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.7.2.1">
>                     <p id="section-toc.1-1.3.2.7.2.1.1"><a href="#section-3.7.1" class="auto internal xref">3.7.1</a>.  <a href="#name-ycbcr" class="internal xref">YCbCr</a></p>
1356,1357c1381,1382
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3.2.7.2.2">
<                     <p id="section-toc.1-1.3.2.7.2.2.1"><a href="#section-3.7.2" class="xref">3.7.2</a>.  <a href="#name-rgb" class="xref">RGB</a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.7.2.2">
>                     <p id="section-toc.1-1.3.2.7.2.2.1"><a href="#section-3.7.2" class="auto internal xref">3.7.2</a>.  <a href="#name-rgb" class="internal xref">RGB</a></p>
1361,1365c1386,1390
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3.2.8">
<                 <p id="section-toc.1-1.3.2.8.1"><a href="#section-3.8" class="xref">3.8</a>.  <a href="#name-coding-of-the-sample-differ" class="xref">Coding of the Sample Difference</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3.2.8.2.1">
<                     <p id="section-toc.1-1.3.2.8.2.1.1"><a href="#section-3.8.1" class="xref">3.8.1</a>.  <a href="#name-range-coding-mode" class="xref">Range Coding Mode</a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.8">
>                 <p id="section-toc.1-1.3.2.8.1"><a href="#section-3.8" class="auto internal xref">3.8</a>.  <a href="#name-coding-of-the-sample-differ" class="internal xref">Coding of the Sample Difference</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.8.2.1">
>                     <p id="section-toc.1-1.3.2.8.2.1.1"><a href="#section-3.8.1" class="auto internal xref">3.8.1</a>.  <a href="#name-range-coding-mode" class="internal xref">Range Coding Mode</a></p>
1367,1368c1392,1393
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.3.2.8.2.2">
<                     <p id="section-toc.1-1.3.2.8.2.2.1"><a href="#section-3.8.2" class="xref">3.8.2</a>.  <a href="#name-golomb-rice-mode" class="xref">Golomb Rice Mode</a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.8.2.2">
>                     <p id="section-toc.1-1.3.2.8.2.2.1"><a href="#section-3.8.2" class="auto internal xref">3.8.2</a>.  <a href="#name-golomb-rice-mode" class="internal xref">Golomb Rice Mode</a></p>
1374,1381c1399,1406
<           <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4">
<             <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-bitstream" class="xref">Bitstream</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.1">
<                 <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-quantization-table-set" class="xref">Quantization Table Set</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.1.2.1">
<                     <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-quant_tables" class="xref"><code>quant_tables</code></a></p>
---
>           <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
>             <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-bitstream" class="internal xref">Bitstream</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
>                 <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-quantization-table-set" class="internal xref">Quantization Table Set</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
>                     <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.  <a href="#name-quant_tables" class="internal xref"><code>quant_tables</code></a></p>
1383,1384c1408,1409
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.1.2.2">
<                     <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-context_count" class="xref"><code>context_count</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
>                     <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="auto internal xref">4.1.2</a>.  <a href="#name-context_count" class="internal xref"><code>context_count</code></a></p>
1388,1392c1413,1417
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2">
<                 <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-parameters" class="xref">Parameters</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.1">
<                     <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="xref">4.2.1</a>.  <a href="#name-version" class="xref"><code>version</code></a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
>                 <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-parameters" class="internal xref">Parameters</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
>                     <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="auto internal xref">4.2.1</a>.  <a href="#name-version" class="internal xref"><code>version</code></a></p>
1394,1395c1419,1420
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.2">
<                     <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="xref">4.2.2</a>.  <a href="#name-micro_version" class="xref"><code>micro_version</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.2">
>                     <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="auto internal xref">4.2.2</a>.  <a href="#name-micro_version" class="internal xref"><code>micro_version</code></a></p>
1397,1398c1422,1423
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.3">
<                     <p id="section-toc.1-1.4.2.2.2.3.1"><a href="#section-4.2.3" class="xref">4.2.3</a>.  <a href="#name-coder_type" class="xref"><code>coder_type</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.3">
>                     <p id="section-toc.1-1.4.2.2.2.3.1"><a href="#section-4.2.3" class="auto internal xref">4.2.3</a>.  <a href="#name-coder_type" class="internal xref"><code>coder_type</code></a></p>
1400,1401c1425,1426
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.4">
<                     <p id="section-toc.1-1.4.2.2.2.4.1"><a href="#section-4.2.4" class="xref">4.2.4</a>.  <a href="#name-state_transition_delta" class="xref"><code>state_transition_delta</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.4">
>                     <p id="section-toc.1-1.4.2.2.2.4.1"><a href="#section-4.2.4" class="auto internal xref">4.2.4</a>.  <a href="#name-state_transition_delta" class="internal xref"><code>state_transition_delta</code></a></p>
1403,1404c1428,1429
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.5">
<                     <p id="section-toc.1-1.4.2.2.2.5.1"><a href="#section-4.2.5" class="xref">4.2.5</a>.  <a href="#name-colorspace_type" class="xref"><code>colorspace_type</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.5">
>                     <p id="section-toc.1-1.4.2.2.2.5.1"><a href="#section-4.2.5" class="auto internal xref">4.2.5</a>.  <a href="#name-colorspace_type" class="internal xref"><code>colorspace_type</code></a></p>
1406,1407c1431,1432
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.6">
<                     <p id="section-toc.1-1.4.2.2.2.6.1"><a href="#section-4.2.6" class="xref">4.2.6</a>.  <a href="#name-chroma_planes" class="xref"><code>chroma_planes</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.6">
>                     <p id="section-toc.1-1.4.2.2.2.6.1"><a href="#section-4.2.6" class="auto internal xref">4.2.6</a>.  <a href="#name-chroma_planes" class="internal xref"><code>chroma_planes</code></a></p>
1409,1410c1434,1435
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.7">
<                     <p id="section-toc.1-1.4.2.2.2.7.1"><a href="#section-4.2.7" class="xref">4.2.7</a>.  <a href="#name-bits_per_raw_sample" class="xref"><code>bits_per_raw_sample</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.7">
>                     <p id="section-toc.1-1.4.2.2.2.7.1"><a href="#section-4.2.7" class="auto internal xref">4.2.7</a>.  <a href="#name-bits_per_raw_sample" class="internal xref"><code>bits_per_raw_sample</code></a></p>
1412,1413c1437,1438
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.8">
<                     <p id="section-toc.1-1.4.2.2.2.8.1"><a href="#section-4.2.8" class="xref">4.2.8</a>.  <a href="#name-log2_h_chroma_subsample" class="xref"><code>log2_h_chroma_subsample</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.8">
>                     <p id="section-toc.1-1.4.2.2.2.8.1"><a href="#section-4.2.8" class="auto internal xref">4.2.8</a>.  <a href="#name-log2_h_chroma_subsample" class="internal xref"><code>log2_h_chroma_subsample</code></a></p>
1415,1416c1440,1441
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.9">
<                     <p id="section-toc.1-1.4.2.2.2.9.1"><a href="#section-4.2.9" class="xref">4.2.9</a>.  <a href="#name-log2_v_chroma_subsample" class="xref"><code>log2_v_chroma_subsample</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.9">
>                     <p id="section-toc.1-1.4.2.2.2.9.1"><a href="#section-4.2.9" class="auto internal xref">4.2.9</a>.  <a href="#name-log2_v_chroma_subsample" class="internal xref"><code>log2_v_chroma_subsample</code></a></p>
1418,1419c1443,1444
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.10">
<                     <p id="section-toc.1-1.4.2.2.2.10.1"><a href="#section-4.2.10" class="xref">4.2.10</a>. <a href="#name-extra_plane" class="xref"><code>extra_plane</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.10">
>                     <p id="section-toc.1-1.4.2.2.2.10.1"><a href="#section-4.2.10" class="auto internal xref">4.2.10</a>. <a href="#name-extra_plane" class="internal xref"><code>extra_plane</code></a></p>
1421,1422c1446,1447
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.11">
<                     <p id="section-toc.1-1.4.2.2.2.11.1"><a href="#section-4.2.11" class="xref">4.2.11</a>. <a href="#name-num_h_slices" class="xref"><code>num_h_slices</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.11">
>                     <p id="section-toc.1-1.4.2.2.2.11.1"><a href="#section-4.2.11" class="auto internal xref">4.2.11</a>. <a href="#name-num_h_slices" class="internal xref"><code>num_h_slices</code></a></p>
1424,1425c1449,1450
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.12">
<                     <p id="section-toc.1-1.4.2.2.2.12.1"><a href="#section-4.2.12" class="xref">4.2.12</a>. <a href="#name-num_v_slices" class="xref"><code>num_v_slices</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.12">
>                     <p id="section-toc.1-1.4.2.2.2.12.1"><a href="#section-4.2.12" class="auto internal xref">4.2.12</a>. <a href="#name-num_v_slices" class="internal xref"><code>num_v_slices</code></a></p>
1427,1428c1452,1453
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.13">
<                     <p id="section-toc.1-1.4.2.2.2.13.1"><a href="#section-4.2.13" class="xref">4.2.13</a>. <a href="#name-quant_table_set_count" class="xref"><code>quant_table_set_count</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.13">
>                     <p id="section-toc.1-1.4.2.2.2.13.1"><a href="#section-4.2.13" class="auto internal xref">4.2.13</a>. <a href="#name-quant_table_set_count" class="internal xref"><code>quant_table_set_count</code></a></p>
1430,1431c1455,1456
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.14">
<                     <p id="section-toc.1-1.4.2.2.2.14.1"><a href="#section-4.2.14" class="xref">4.2.14</a>. <a href="#name-states_coded" class="xref"><code>states_coded</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.14">
>                     <p id="section-toc.1-1.4.2.2.2.14.1"><a href="#section-4.2.14" class="auto internal xref">4.2.14</a>. <a href="#name-states_coded" class="internal xref"><code>states_coded</code></a></p>
1433,1434c1458,1459
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.15">
<                     <p id="section-toc.1-1.4.2.2.2.15.1"><a href="#section-4.2.15" class="xref">4.2.15</a>. <a href="#name-initial_state_delta" class="xref"><code>initial_state_delta</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.15">
>                     <p id="section-toc.1-1.4.2.2.2.15.1"><a href="#section-4.2.15" class="auto internal xref">4.2.15</a>. <a href="#name-initial_state_delta" class="internal xref"><code>initial_state_delta</code></a></p>
1436,1437c1461,1462
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.16">
<                     <p id="section-toc.1-1.4.2.2.2.16.1"><a href="#section-4.2.16" class="xref">4.2.16</a>. <a href="#name-ec" class="xref"><code>ec</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.16">
>                     <p id="section-toc.1-1.4.2.2.2.16.1"><a href="#section-4.2.16" class="auto internal xref">4.2.16</a>. <a href="#name-ec" class="internal xref"><code>ec</code></a></p>
1439,1440c1464,1465
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.2.2.17">
<                     <p id="section-toc.1-1.4.2.2.2.17.1"><a href="#section-4.2.17" class="xref">4.2.17</a>. <a href="#name-intra" class="xref"><code>intra</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.17">
>                     <p id="section-toc.1-1.4.2.2.2.17.1"><a href="#section-4.2.17" class="auto internal xref">4.2.17</a>. <a href="#name-intra" class="internal xref"><code>intra</code></a></p>
1444,1448c1469,1473
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.3">
<                 <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-configuration-record" class="xref">Configuration Record</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.3.2.1">
<                     <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="xref">4.3.1</a>.  <a href="#name-reserved_for_future_use" class="xref"><code>reserved_for_future_use</code></a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
>                 <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-configuration-record" class="internal xref">Configuration Record</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
>                     <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="auto internal xref">4.3.1</a>.  <a href="#name-reserved_for_future_use" class="internal xref"><code>reserved_for_future_use</code></a></p>
1450,1451c1475,1476
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.3.2.2">
<                     <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="xref">4.3.2</a>.  <a href="#name-configuration_record_crc_pa" class="xref"><code>configuration_record_crc_parity</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.2">
>                     <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="auto internal xref">4.3.2</a>.  <a href="#name-configuration_record_crc_pa" class="internal xref"><code>configuration_record_crc_parity</code></a></p>
1453,1454c1478,1479
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.3.2.3">
<                     <p id="section-toc.1-1.4.2.3.2.3.1"><a href="#section-4.3.3" class="xref">4.3.3</a>.  <a href="#name-mapping-ffv1-into-container" class="xref">Mapping FFV1 into Containers</a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.3">
>                     <p id="section-toc.1-1.4.2.3.2.3.1"><a href="#section-4.3.3" class="auto internal xref">4.3.3</a>.  <a href="#name-mapping-ffv1-into-container" class="internal xref">Mapping FFV1 into Containers</a></p>
1458,1459c1483,1484
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.4">
<                 <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-frame" class="xref">Frame</a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
>                 <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-frame" class="internal xref">Frame</a></p>
1461,1462c1486,1487
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.5">
<                 <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-slice" class="xref">Slice</a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
>                 <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-slice" class="internal xref">Slice</a></p>
1464,1468c1489,1493
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.6">
<                 <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="xref">4.6</a>.  <a href="#name-slice-header" class="xref">Slice Header</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.6.2.1">
<                     <p id="section-toc.1-1.4.2.6.2.1.1"><a href="#section-4.6.1" class="xref">4.6.1</a>.  <a href="#name-slice_x" class="xref"><code>slice_x</code></a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
>                 <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-slice-header" class="internal xref">Slice Header</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.1">
>                     <p id="section-toc.1-1.4.2.6.2.1.1"><a href="#section-4.6.1" class="auto internal xref">4.6.1</a>.  <a href="#name-slice_x" class="internal xref"><code>slice_x</code></a></p>
1470,1471c1495,1496
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.6.2.2">
<                     <p id="section-toc.1-1.4.2.6.2.2.1"><a href="#section-4.6.2" class="xref">4.6.2</a>.  <a href="#name-slice_y" class="xref"><code>slice_y</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.2">
>                     <p id="section-toc.1-1.4.2.6.2.2.1"><a href="#section-4.6.2" class="auto internal xref">4.6.2</a>.  <a href="#name-slice_y" class="internal xref"><code>slice_y</code></a></p>
1473,1474c1498,1499
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.6.2.3">
<                     <p id="section-toc.1-1.4.2.6.2.3.1"><a href="#section-4.6.3" class="xref">4.6.3</a>.  <a href="#name-slice_width" class="xref"><code>slice_width</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.3">
>                     <p id="section-toc.1-1.4.2.6.2.3.1"><a href="#section-4.6.3" class="auto internal xref">4.6.3</a>.  <a href="#name-slice_width" class="internal xref"><code>slice_width</code></a></p>
1476,1477c1501,1502
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.6.2.4">
<                     <p id="section-toc.1-1.4.2.6.2.4.1"><a href="#section-4.6.4" class="xref">4.6.4</a>.  <a href="#name-slice_height" class="xref"><code>slice_height</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.4">
>                     <p id="section-toc.1-1.4.2.6.2.4.1"><a href="#section-4.6.4" class="auto internal xref">4.6.4</a>.  <a href="#name-slice_height" class="internal xref"><code>slice_height</code></a></p>
1479,1480c1504,1505
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.6.2.5">
<                     <p id="section-toc.1-1.4.2.6.2.5.1"><a href="#section-4.6.5" class="xref">4.6.5</a>.  <a href="#name-quant_table_set_index_count" class="xref"><code>quant_table_set_index_count</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.5">
>                     <p id="section-toc.1-1.4.2.6.2.5.1"><a href="#section-4.6.5" class="auto internal xref">4.6.5</a>.  <a href="#name-quant_table_set_index_count" class="internal xref"><code>quant_table_set_index_count</code></a></p>
1482,1483c1507,1508
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.6.2.6">
<                     <p id="section-toc.1-1.4.2.6.2.6.1"><a href="#section-4.6.6" class="xref">4.6.6</a>.  <a href="#name-quant_table_set_index" class="xref"><code>quant_table_set_index</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.6">
>                     <p id="section-toc.1-1.4.2.6.2.6.1"><a href="#section-4.6.6" class="auto internal xref">4.6.6</a>.  <a href="#name-quant_table_set_index" class="internal xref"><code>quant_table_set_index</code></a></p>
1485,1486c1510,1511
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.6.2.7">
<                     <p id="section-toc.1-1.4.2.6.2.7.1"><a href="#section-4.6.7" class="xref">4.6.7</a>.  <a href="#name-picture_structure" class="xref"><code>picture_structure</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.7">
>                     <p id="section-toc.1-1.4.2.6.2.7.1"><a href="#section-4.6.7" class="auto internal xref">4.6.7</a>.  <a href="#name-picture_structure" class="internal xref"><code>picture_structure</code></a></p>
1488,1489c1513,1514
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.6.2.8">
<                     <p id="section-toc.1-1.4.2.6.2.8.1"><a href="#section-4.6.8" class="xref">4.6.8</a>.  <a href="#name-sar_num" class="xref"><code>sar_num</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.8">
>                     <p id="section-toc.1-1.4.2.6.2.8.1"><a href="#section-4.6.8" class="auto internal xref">4.6.8</a>.  <a href="#name-sar_num" class="internal xref"><code>sar_num</code></a></p>
1491,1492c1516,1517
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.6.2.9">
<                     <p id="section-toc.1-1.4.2.6.2.9.1"><a href="#section-4.6.9" class="xref">4.6.9</a>.  <a href="#name-sar_den" class="xref"><code>sar_den</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.9">
>                     <p id="section-toc.1-1.4.2.6.2.9.1"><a href="#section-4.6.9" class="auto internal xref">4.6.9</a>.  <a href="#name-sar_den" class="internal xref"><code>sar_den</code></a></p>
1496,1500c1521,1525
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.7">
<                 <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="xref">4.7</a>.  <a href="#name-slice-content" class="xref">Slice Content</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.7.2.1">
<                     <p id="section-toc.1-1.4.2.7.2.1.1"><a href="#section-4.7.1" class="xref">4.7.1</a>.  <a href="#name-primary_color_count" class="xref"><code>primary_color_count</code></a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7">
>                 <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="auto internal xref">4.7</a>.  <a href="#name-slice-content" class="internal xref">Slice Content</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7.2.1">
>                     <p id="section-toc.1-1.4.2.7.2.1.1"><a href="#section-4.7.1" class="auto internal xref">4.7.1</a>.  <a href="#name-primary_color_count" class="internal xref"><code>primary_color_count</code></a></p>
1502,1503c1527,1528
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.7.2.2">
<                     <p id="section-toc.1-1.4.2.7.2.2.1"><a href="#section-4.7.2" class="xref">4.7.2</a>.  <a href="#name-plane_pixel_height" class="xref"><code>plane_pixel_height</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7.2.2">
>                     <p id="section-toc.1-1.4.2.7.2.2.1"><a href="#section-4.7.2" class="auto internal xref">4.7.2</a>.  <a href="#name-plane_pixel_height" class="internal xref"><code>plane_pixel_height</code></a></p>
1505,1506c1530,1531
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.7.2.3">
<                     <p id="section-toc.1-1.4.2.7.2.3.1"><a href="#section-4.7.3" class="xref">4.7.3</a>.  <a href="#name-slice_pixel_height" class="xref"><code>slice_pixel_height</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7.2.3">
>                     <p id="section-toc.1-1.4.2.7.2.3.1"><a href="#section-4.7.3" class="auto internal xref">4.7.3</a>.  <a href="#name-slice_pixel_height" class="internal xref"><code>slice_pixel_height</code></a></p>
1508,1509c1533,1534
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.7.2.4">
<                     <p id="section-toc.1-1.4.2.7.2.4.1"><a href="#section-4.7.4" class="xref">4.7.4</a>.  <a href="#name-slice_pixel_y" class="xref"><code>slice_pixel_y</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7.2.4">
>                     <p id="section-toc.1-1.4.2.7.2.4.1"><a href="#section-4.7.4" class="auto internal xref">4.7.4</a>.  <a href="#name-slice_pixel_y" class="internal xref"><code>slice_pixel_y</code></a></p>
1513,1517c1538,1542
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.8">
<                 <p id="section-toc.1-1.4.2.8.1"><a href="#section-4.8" class="xref">4.8</a>.  <a href="#name-line" class="xref">Line</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.8.2.1">
<                     <p id="section-toc.1-1.4.2.8.2.1.1"><a href="#section-4.8.1" class="xref">4.8.1</a>.  <a href="#name-plane_pixel_width" class="xref"><code>plane_pixel_width</code></a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8">
>                 <p id="section-toc.1-1.4.2.8.1"><a href="#section-4.8" class="auto internal xref">4.8</a>.  <a href="#name-line" class="internal xref">Line</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8.2.1">
>                     <p id="section-toc.1-1.4.2.8.2.1.1"><a href="#section-4.8.1" class="auto internal xref">4.8.1</a>.  <a href="#name-plane_pixel_width" class="internal xref"><code>plane_pixel_width</code></a></p>
1519,1520c1544,1545
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.8.2.2">
<                     <p id="section-toc.1-1.4.2.8.2.2.1"><a href="#section-4.8.2" class="xref">4.8.2</a>.  <a href="#name-slice_pixel_width" class="xref"><code>slice_pixel_width</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8.2.2">
>                     <p id="section-toc.1-1.4.2.8.2.2.1"><a href="#section-4.8.2" class="auto internal xref">4.8.2</a>.  <a href="#name-slice_pixel_width" class="internal xref"><code>slice_pixel_width</code></a></p>
1522,1523c1547,1548
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.8.2.3">
<                     <p id="section-toc.1-1.4.2.8.2.3.1"><a href="#section-4.8.3" class="xref">4.8.3</a>.  <a href="#name-slice_pixel_x" class="xref"><code>slice_pixel_x</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8.2.3">
>                     <p id="section-toc.1-1.4.2.8.2.3.1"><a href="#section-4.8.3" class="auto internal xref">4.8.3</a>.  <a href="#name-slice_pixel_x" class="internal xref"><code>slice_pixel_x</code></a></p>
1525,1526c1550,1551
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.8.2.4">
<                     <p id="section-toc.1-1.4.2.8.2.4.1"><a href="#section-4.8.4" class="xref">4.8.4</a>.  <a href="#name-sample_difference" class="xref"><code>sample_difference</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8.2.4">
>                     <p id="section-toc.1-1.4.2.8.2.4.1"><a href="#section-4.8.4" class="auto internal xref">4.8.4</a>.  <a href="#name-sample_difference" class="internal xref"><code>sample_difference</code></a></p>
1530,1534c1555,1559
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.9">
<                 <p id="section-toc.1-1.4.2.9.1"><a href="#section-4.9" class="xref">4.9</a>.  <a href="#name-slice-footer" class="xref">Slice Footer</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.9.2.1">
<                     <p id="section-toc.1-1.4.2.9.2.1.1"><a href="#section-4.9.1" class="xref">4.9.1</a>.  <a href="#name-slice_size" class="xref"><code>slice_size</code></a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.9">
>                 <p id="section-toc.1-1.4.2.9.1"><a href="#section-4.9" class="auto internal xref">4.9</a>.  <a href="#name-slice-footer" class="internal xref">Slice Footer</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.9.2.1">
>                     <p id="section-toc.1-1.4.2.9.2.1.1"><a href="#section-4.9.1" class="auto internal xref">4.9.1</a>.  <a href="#name-slice_size" class="internal xref"><code>slice_size</code></a></p>
1536,1537c1561,1562
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.9.2.2">
<                     <p id="section-toc.1-1.4.2.9.2.2.1"><a href="#section-4.9.2" class="xref">4.9.2</a>.  <a href="#name-error_status" class="xref"><code>error_status</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.9.2.2">
>                     <p id="section-toc.1-1.4.2.9.2.2.1"><a href="#section-4.9.2" class="auto internal xref">4.9.2</a>.  <a href="#name-error_status" class="internal xref"><code>error_status</code></a></p>
1539,1540c1564,1565
<                   <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.4.2.9.2.3">
<                     <p id="section-toc.1-1.4.2.9.2.3.1"><a href="#section-4.9.3" class="xref">4.9.3</a>.  <a href="#name-slice_crc_parity" class="xref"><code>slice_crc_parity</code></a></p>
---
>                   <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.9.2.3">
>                     <p id="section-toc.1-1.4.2.9.2.3.1"><a href="#section-4.9.3" class="auto internal xref">4.9.3</a>.  <a href="#name-slice_crc_parity" class="internal xref"><code>slice_crc_parity</code></a></p>
1546,1547c1571,1572
<           <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.5">
<             <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-restrictions" class="xref">Restrictions</a></p>
---
>           <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
>             <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-restrictions" class="internal xref">Restrictions</a></p>
1549,1550c1574,1575
<           <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.6">
<             <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
---
>           <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
>             <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
1552,1556c1577,1581
<           <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.7">
<             <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.7.2.1">
<                 <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-media-type-definition" class="xref">Media Type Definition</a></p>
---
>           <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
>             <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
>                 <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-media-type-definition" class="internal xref">Media Type Definition</a></p>
1560,1564c1585,1589
<           <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.8">
<             <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-references" class="xref">References</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.8.2.1">
<                 <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
---
>           <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
>             <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-references" class="internal xref">References</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
>                 <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
1566,1567c1591,1592
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.8.2.2">
<                 <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
>                 <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
1571,1572c1596,1597
<           <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.9">
<             <p id="section-toc.1-1.9.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-multithreaded-decoder-imple" class="xref">Multithreaded Decoder Implementation Suggestions</a></p>
---
>           <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
>             <p id="section-toc.1-1.9.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-multithreaded-decoder-imple" class="internal xref">Multithreaded Decoder Implementation Suggestions</a></p>
1574,1575c1599,1600
<           <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.10">
<             <p id="section-toc.1-1.10.1"><a href="#appendix-B" class="xref">Appendix B</a>.  <a href="#name-future-handling-of-some-str" class="xref">Future Handling of Some Streams Created by Nonconforming Encoders</a></p>
---
>           <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
>             <p id="section-toc.1-1.10.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-future-handling-of-some-str" class="internal xref">Future Handling of Some Streams Created by Nonconforming Encoders</a></p>
1577,1581c1602,1606
<           <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.11">
<             <p id="section-toc.1-1.11.1"><a href="#appendix-C" class="xref">Appendix C</a>.  <a href="#name-ffv1-implementations" class="xref">FFV1 Implementations</a></p>
< <ul class="toc compact ulEmpty ulBare">
< <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.11.2.1">
<                 <p id="section-toc.1-1.11.2.1.1"><a href="#appendix-C.1" class="xref">C.1</a>.  <a href="#name-ffmpeg-ffv1-codec" class="xref">FFmpeg FFV1 Codec</a></p>
---
>           <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
>             <p id="section-toc.1-1.11.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.  <a href="#name-ffv1-implementations" class="internal xref">FFV1 Implementations</a></p>
> <ul class="compact toc ulBare ulEmpty">
> <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
>                 <p id="section-toc.1-1.11.2.1.1"><a href="#appendix-C.1" class="auto internal xref">C.1</a>.  <a href="#name-ffmpeg-ffv1-codec" class="internal xref">FFmpeg FFV1 Codec</a></p>
1583,1584c1608,1609
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.11.2.2">
<                 <p id="section-toc.1-1.11.2.2.1"><a href="#appendix-C.2" class="xref">C.2</a>.  <a href="#name-ffv1-decoder-in-go" class="xref">FFV1 Decoder in Go</a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
>                 <p id="section-toc.1-1.11.2.2.1"><a href="#appendix-C.2" class="auto internal xref">C.2</a>.  <a href="#name-ffv1-decoder-in-go" class="internal xref">FFV1 Decoder in Go</a></p>
1586,1587c1611,1612
<               <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.11.2.3">
<                 <p id="section-toc.1-1.11.2.3.1"><a href="#appendix-C.3" class="xref">C.3</a>.  <a href="#name-mediaconch" class="xref">MediaConch</a></p>
---
>               <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.3">
>                 <p id="section-toc.1-1.11.2.3.1"><a href="#appendix-C.3" class="auto internal xref">C.3</a>.  <a href="#name-mediaconch" class="internal xref">MediaConch</a></p>
1591,1592c1616,1617
<           <li class="toc compact ulEmpty ulBare" id="section-toc.1-1.12">
<             <p id="section-toc.1-1.12.1"><a href="#appendix-D" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
---
>           <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
>             <p id="section-toc.1-1.12.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
1607c1632
<           <p id="section-1-3.1.1">Version 0 of FFV1 was the original implementation of FFV1 and was flagged as stable on April 14, 2006 <span>[<a href="#FFV1_V0" class="xref">FFV1_V0</a>]</span>.<a href="#section-1-3.1.1" class="pilcrow">¶</a></p>
---
>           <p id="section-1-3.1.1">Version 0 of FFV1 was the original implementation of FFV1 and was flagged as stable on April 14, 2006 <span>[<a href="#FFV1_V0" class="cite xref">FFV1_V0</a>]</span>.<a href="#section-1-3.1.1" class="pilcrow">¶</a></p>
1610c1635
<           <p id="section-1-3.2.1">Version 1 of FFV1 adds support of more video bit depths and was flagged as stable on April 24, 2009 <span>[<a href="#FFV1_V1" class="xref">FFV1_V1</a>]</span>.<a href="#section-1-3.2.1" class="pilcrow">¶</a></p>
---
>           <p id="section-1-3.2.1">Version 1 of FFV1 adds support of more video bit depths and was flagged as stable on April 24, 2009 <span>[<a href="#FFV1_V1" class="cite xref">FFV1_V1</a>]</span>.<a href="#section-1-3.2.1" class="pilcrow">¶</a></p>
1616c1641
<           <p id="section-1-3.4.1">Version 3 of FFV1 adds several features such as increased description of the characteristics of the encoding images and embedded Cyclic Redundancy Check (CRC) data to support fixity verification of the encoding. Version 3 was flagged as stable on August 17, 2013 <span>[<a href="#FFV1_V3" class="xref">FFV1_V3</a>]</span>.<a href="#section-1-3.4.1" class="pilcrow">¶</a></p>
---
>           <p id="section-1-3.4.1">Version 3 of FFV1 adds several features such as increased description of the characteristics of the encoding images and embedded Cyclic Redundancy Check (CRC) data to support fixity verification of the encoding. Version 3 was flagged as stable on August 17, 2013 <span>[<a href="#FFV1_V3" class="cite xref">FFV1_V3</a>]</span>.<a href="#section-1-3.4.1" class="pilcrow">¶</a></p>
1619c1644
< <p id="section-1-4">This document assumes familiarity with mathematical and coding concepts such as Range encoding <span>[<a href="#Range-Encoding" class="xref">Range-Encoding</a>]</span> and YCbCr color spaces <span>[<a href="#YCbCr" class="xref">YCbCr</a>]</span>.<a href="#section-1-4" class="pilcrow">¶</a></p>
---
> <p id="section-1-4">This document assumes familiarity with mathematical and coding concepts such as Range encoding <span>[<a href="#Range-Encoding" class="cite xref">Range-Encoding</a>]</span> and YCbCr color spaces <span>[<a href="#YCbCr" class="cite xref">YCbCr</a>]</span>.<a href="#section-1-4" class="pilcrow">¶</a></p>
1628c1653
< <p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>", "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
---
> <p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>", "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
1640c1665
<           <dd style="margin-left: 1.5em" id="section-2.1-1.4">A format that encapsulates Frames (see <a href="#frame" class="xref">Section 4.4</a>) and (when required) a <code>Configuration Record</code> into a bitstream.<a href="#section-2.1-1.4" class="pilcrow">¶</a>
---
>           <dd style="margin-left: 1.5em" id="section-2.1-1.4">A format that encapsulates Frames (see <a href="#frame" class="auto internal xref">Section 4.4</a>) and (when required) a <code>Configuration Record</code> into a bitstream.<a href="#section-2.1-1.4" class="pilcrow">¶</a>
1648c1673
<           <dd style="margin-left: 1.5em" id="section-2.1-1.8">A value stored in the bitstream, which is defined and decoded through one of the methods described in <a href="#tablePseudoCodeSymbols" class="xref">Table 4</a>.<a href="#section-2.1-1.8" class="pilcrow">¶</a>
---
>           <dd style="margin-left: 1.5em" id="section-2.1-1.8">A value stored in the bitstream, which is defined and decoded through one of the methods described in <a href="#tablePseudoCodeSymbols" class="auto internal xref">Table 4</a>.<a href="#section-2.1-1.8" class="pilcrow">¶</a>
1692,1693c1717,1718
< <p id="section-2.2.1-1">The FFV1 bitstream is described in this document using pseudocode. Note that the pseudocode is used to illustrate the structure of FFV1 and is not intended to specify any particular implementation. The pseudocode used is based upon the C programming language <span>[<a href="#ISO.9899.2018" class="xref">ISO.9899.2018</a>]</span> and uses its <code>if/else</code>, <code>while</code>, and <code>for</code> keywords as well as functions defined within this document.<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
< <p id="section-2.2.1-2">In some instances, pseudocode is presented in a two-column format such as shown in <a href="#figurePseudoCode" class="xref">Figure 1</a>. In this form, the <code>type</code> column provides a symbol as defined in <a href="#tablePseudoCodeSymbols" class="xref">Table 4</a> that defines the storage of the data referenced in that same line of pseudocode.<a href="#section-2.2.1-2" class="pilcrow">¶</a></p>
---
> <p id="section-2.2.1-1">The FFV1 bitstream is described in this document using pseudocode. Note that the pseudocode is used to illustrate the structure of FFV1 and is not intended to specify any particular implementation. The pseudocode used is based upon the C programming language <span>[<a href="#ISO.9899.2018" class="cite xref">ISO.9899.2018</a>]</span> and uses its <code>if/else</code>, <code>while</code>, and <code>for</code> keywords as well as functions defined within this document.<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
> <p id="section-2.2.1-2">In some instances, pseudocode is presented in a two-column format such as shown in <a href="#figurePseudoCode" class="auto internal xref">Figure 1</a>. In this form, the <code>type</code> column provides a symbol as defined in <a href="#tablePseudoCodeSymbols" class="auto internal xref">Table 4</a> that defines the storage of the data referenced in that same line of pseudocode.<a href="#section-2.2.1-2" class="pilcrow">¶</a></p>
1696,1697c1721,1722
<             <div id="section-2.2.1-3.1">
< <pre class="sourcecode lang-pseudocode">
---
>             <div class="lang-pseudocode sourcecode" id="section-2.2.1-3.1">
> <pre>
1716c1741
< <p id="section-2.2.2-1">Note: the operators and the order of precedence are the same as used in the C programming language <span>[<a href="#ISO.9899.2018" class="xref">ISO.9899.2018</a>]</span>, with the exception of <code>&gt;&gt;</code> (removal of implementation-defined behavior) and <code>^</code> (power instead of XOR) operators, which are redefined within this section.<a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
---
> <p id="section-2.2.2-1">Note: the operators and the order of precedence are the same as used in the C programming language <span>[<a href="#ISO.9899.2018" class="cite xref">ISO.9899.2018</a>]</span>, with the exception of <code>&gt;&gt;</code> (removal of implementation-defined behavior) and <code>^</code> (power instead of XOR) operators, which are redefined within this section.<a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
1784c1809
< <div class="artwork art-text alignLeft art-ascii-art" id="section-2.2.6-2">
---
> <div class="alignLeft art-ascii-art art-text artwork" id="section-2.2.6-2">
1817c1842
< <p id="section-2.2.8-1"><code>NumBytes</code> is a nonnegative integer that expresses the size in 8-bit octets of a particular FFV1 <code>Configuration Record</code> or <code>Frame</code>. FFV1 relies on its container to store the <code>NumBytes</code> values; see <a href="#mapping-ffv1-into-containers" class="xref">Section 4.3.3</a>.<a href="#section-2.2.8-1" class="pilcrow">¶</a></p>
---
> <p id="section-2.2.8-1"><code>NumBytes</code> is a nonnegative integer that expresses the size in 8-bit octets of a particular FFV1 <code>Configuration Record</code> or <code>Frame</code>. FFV1 relies on its container to store the <code>NumBytes</code> values; see <a href="#mapping-ffv1-into-containers" class="auto internal xref">Section 4.3.3</a>.<a href="#section-2.2.8-1" class="pilcrow">¶</a></p>
1868c1893
< <p id="section-3-1">For each <code>Slice</code> (as described in <a href="#slice" class="xref">Section 4.5</a>) of a Frame, the Planes, Lines, and Samples are coded in an order determined by the color space (see <a href="#color-spaces" class="xref">Section 3.7</a>). Each Sample is predicted by the median predictor as described in <a href="#median-predictor" class="xref">Section 3.3</a> from other Samples within the same Plane, and the difference is stored using the method described in <a href="#coding-of-the-sample-difference" class="xref">Section 3.8</a>.<a href="#section-3-1" class="pilcrow">¶</a></p>
---
> <p id="section-3-1">For each <code>Slice</code> (as described in <a href="#slice" class="auto internal xref">Section 4.5</a>) of a Frame, the Planes, Lines, and Samples are coded in an order determined by the color space (see <a href="#color-spaces" class="auto internal xref">Section 3.7</a>). Each Sample is predicted by the median predictor as described in <a href="#median-predictor" class="auto internal xref">Section 3.3</a> from other Samples within the same Plane, and the difference is stored using the method described in <a href="#coding-of-the-sample-difference" class="auto internal xref">Section 3.8</a>.<a href="#section-3-1" class="pilcrow">¶</a></p>
1883c1908
< <p id="section-3.1-3"><a href="#figureAssumedBorder" class="xref">Figure 2</a> depicts a Slice of nine Samples <code>a,b,c,d,e,f,g,h,i</code> in a three-by-three arrangement along with its assumed border.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
---
> <p id="section-3.1-3"><a href="#figureAssumedBorder" class="auto internal xref">Figure 2</a> depicts a Slice of nine Samples <code>a,b,c,d,e,f,g,h,i</code> in a three-by-three arrangement along with its assumed border.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
1886c1911
<           <div class="artwork art-text alignLeft art-ascii-art" id="section-3.1-4.1">
---
>           <div class="alignLeft art-ascii-art art-text artwork" id="section-3.1-4.1">
1914c1939
< <p id="section-3.2-1">Relative to any Sample <code>X</code>, six other relatively positioned Samples from the coded Samples and presumed border are identified according to the labels used in <a href="#figureRelativeSampleNames" class="xref">Figure 3</a>. The labels for these relatively positioned Samples are used within the median predictor and context.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
---
> <p id="section-3.2-1">Relative to any Sample <code>X</code>, six other relatively positioned Samples from the coded Samples and presumed border are identified according to the labels used in <a href="#figureRelativeSampleNames" class="auto internal xref">Figure 3</a>. The labels for these relatively positioned Samples are used within the median predictor and context.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
1917c1942
<           <div class="artwork art-text alignLeft art-ascii-art" id="section-3.2-2.1">
---
>           <div class="alignLeft art-ascii-art art-text artwork" id="section-3.2-2.1">
1941c1966
< <div class="artwork art-text alignLeft art-ascii-art" id="section-3.3-2">
---
> <div class="alignLeft art-ascii-art art-text artwork" id="section-3.3-2">
1946c1971
< <p id="section-3.3-3">Note that this prediction template is also used in <span>[<a href="#ISO.14495-1.1999" class="xref">ISO.14495-1.1999</a>]</span> and <span>[<a href="#HuffYUV" class="xref">HuffYUV</a>]</span>.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
---
> <p id="section-3.3-3">Note that this prediction template is also used in <span>[<a href="#ISO.14495-1.1999" class="cite xref">ISO.14495-1.1999</a>]</span> and <span>[<a href="#HuffYUV" class="cite xref">HuffYUV</a>]</span>.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
1952,1953c1977,1978
< <p id="section-3.3.1-1">If <code>colorspace_type == 0 &amp;&amp; bits_per_raw_sample == 16 &amp;&amp; ( coder_type == 1 || coder_type == 2 )</code> (see Sections <a href="#colorspace-type" class="xref">4.2.5</a>, <a href="#bits-per-raw-sample" class="xref">4.2.7</a>, and <a href="#coder-type" class="xref">4.2.3</a>), the following median predictor <span class="bcp14">MUST</span> be used:<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
< <div class="artwork art-text alignLeft art-ascii-art" id="section-3.3.1-2">
---
> <p id="section-3.3.1-1">If <code>colorspace_type == 0 &amp;&amp; bits_per_raw_sample == 16 &amp;&amp; ( coder_type == 1 || coder_type == 2 )</code> (see Sections <a href="#colorspace-type" class="auto internal xref">4.2.5</a>, <a href="#bits-per-raw-sample" class="auto internal xref">4.2.7</a>, and <a href="#coder-type" class="auto internal xref">4.2.3</a>), the following median predictor <span class="bcp14">MUST</span> be used:<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
> <div class="alignLeft art-ascii-art art-text artwork" id="section-3.3.1-2">
1959c1984
< <div class="artwork art-text alignLeft art-ascii-art" id="section-3.3.1-4">
---
> <div class="alignLeft art-ascii-art art-text artwork" id="section-3.3.1-4">
1966c1991
< <p id="section-3.3.1-5">Background: a two's complement 16-bit signed integer was used for storing Sample values in all known implementations of FFV1 bitstream (see  <a href="#ffv1-implementations" class="xref">Appendix C</a>). So in some circumstances, the most significant bit was wrongly interpreted (used as a sign bit instead of the 16th bit of an unsigned integer). Note that when the issue was discovered, the only impacted configuration of all known implementations was the 16-bit YCbCr with no pixel transformation and with the range coder coder type, as the other potentially impacted configurations (e.g., the 15/16-bit JPEG 2000 Reversible Color Transform (RCT) <span>[<a href="#ISO.15444-1.2019" class="xref">ISO.15444-1.2019</a>]</span> with range coder or the 16-bit content with the Golomb Rice coder type) were not implemented. Meanwhile, the 16-bit JPEG 2000 RCT with range coder was deployed without this issue in one implementation and validated by one conformance checker. It is expected (to be confirmed) that this exception for the median predictor will be removed in the next version of the FFV1 bitstream.<a href="#section-3.3.1-5" class="pilcrow">¶</a></p>
---
> <p id="section-3.3.1-5">Background: a two's complement 16-bit signed integer was used for storing Sample values in all known implementations of FFV1 bitstream (see  <a href="#ffv1-implementations" class="auto internal xref">Appendix C</a>). So in some circumstances, the most significant bit was wrongly interpreted (used as a sign bit instead of the 16th bit of an unsigned integer). Note that when the issue was discovered, the only impacted configuration of all known implementations was the 16-bit YCbCr with no pixel transformation and with the range coder coder type, as the other potentially impacted configurations (e.g., the 15/16-bit JPEG 2000 Reversible Color Transform (RCT) <span>[<a href="#ISO.15444-1.2019" class="cite xref">ISO.15444-1.2019</a>]</span> with range coder or the 16-bit content with the Golomb Rice coder type) were not implemented. Meanwhile, the 16-bit JPEG 2000 RCT with range coder was deployed without this issue in one implementation and validated by one conformance checker. It is expected (to be confirmed) that this exception for the median predictor will be removed in the next version of the FFV1 bitstream.<a href="#section-3.3.1-5" class="pilcrow">¶</a></p>
1976c2001
< <p id="section-3.4-1">Quantization Tables are used on Sample Differences (see <a href="#coding-of-the-sample-difference" class="xref">Section 3.8</a>), so Quantized Sample Differences are stored in the bitstream.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
---
> <p id="section-3.4-1">Quantization Tables are used on Sample Differences (see <a href="#coding-of-the-sample-difference" class="auto internal xref">Section 3.8</a>), so Quantized Sample Differences are stored in the bitstream.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
1981c2006
<             <div class="artwork art-svg alignLeft" id="section-3.4-3.1.1">
---
>             <div class="alignLeft art-svg artwork" id="section-3.4-3.1.1">
2136c2161
< <p id="section-3.4-4">In this formula, <code>i</code> is the Quantization Table Set index, <code>j</code> is the Quantized Table index, and <code>k</code> is the Quantized Sample Difference (see <a href="#quant-tables" class="xref">Section 4.1.1</a>).<a href="#section-3.4-4" class="pilcrow">¶</a></p>
---
> <p id="section-3.4-4">In this formula, <code>i</code> is the Quantization Table Set index, <code>j</code> is the Quantized Table index, and <code>k</code> is the Quantized Sample Difference (see <a href="#quant-tables" class="auto internal xref">Section 4.1.1</a>).<a href="#section-3.4-4" class="pilcrow">¶</a></p>
2148c2173
<             <div class="artwork art-svg alignLeft" id="section-3.5-2.1.1">
---
>             <div class="alignLeft art-svg artwork" id="section-3.5-2.1.1">
2427c2452
< <p id="section-3.7.2-3">JPEG 2000 RCT is a Reversible Color Transform that codes RGB (Red, Green, Blue) Planes losslessly in a modified YCbCr color space <span>[<a href="#ISO.15444-1.2019" class="xref">ISO.15444-1.2019</a>]</span>. Reversible pixel transformations between YCbCr and RGB use the following formulae:<a href="#section-3.7.2-3" class="pilcrow">¶</a></p>
---
> <p id="section-3.7.2-3">JPEG 2000 RCT is a Reversible Color Transform that codes RGB (Red, Green, Blue) Planes losslessly in a modified YCbCr color space <span>[<a href="#ISO.15444-1.2019" class="cite xref">ISO.15444-1.2019</a>]</span>. Reversible pixel transformations between YCbCr and RGB use the following formulae:<a href="#section-3.7.2-3" class="pilcrow">¶</a></p>
2431c2456
<               <div class="artwork art-svg alignLeft" id="section-3.7.2-4.1.1">
---
>               <div class="alignLeft art-svg artwork" id="section-3.7.2-4.1.1">
2571c2596
<               <div class="artwork art-svg alignLeft" id="section-3.7.2-5.1.1">
---
>               <div class="alignLeft art-svg artwork" id="section-3.7.2-5.1.1">
2711c2736
< <div class="artwork art-text alignLeft art-ascii-art" id="section-3.7.2-9">
---
> <div class="alignLeft art-ascii-art art-text artwork" id="section-3.7.2-9">
2733c2758
<                 <div class="artwork art-svg alignLeft" id="section-3.7.2.1-2.1.1">
---
>                 <div class="alignLeft art-svg artwork" id="section-3.7.2.1-2.1.1">
2873c2898
<                 <div class="artwork art-svg alignLeft" id="section-3.7.2.1-3.1.1">
---
>                 <div class="alignLeft art-svg artwork" id="section-3.7.2.1-3.1.1">
3022c3047
< <p id="section-3.8-1">Instead of coding the n+1 bits of the Sample Difference with Huffman or Range coding (or n+2 bits, in the case of JPEG 2000 RCT), only the n (or n+1, in the case of JPEG 2000 RCT) least significant bits are used, since this is sufficient to recover the original Sample. In <a href="#figureSampleDifference" class="xref">Figure 10</a>, the term <code>bits</code> represents <code>bits_per_raw_sample + 1</code> for JPEG 2000 RCT or <code>bits_per_raw_sample</code> otherwise:<a href="#section-3.8-1" class="pilcrow">¶</a></p>
---
> <p id="section-3.8-1">Instead of coding the n+1 bits of the Sample Difference with Huffman or Range coding (or n+2 bits, in the case of JPEG 2000 RCT), only the n (or n+1, in the case of JPEG 2000 RCT) least significant bits are used, since this is sufficient to recover the original Sample. In <a href="#figureSampleDifference" class="auto internal xref">Figure 10</a>, the term <code>bits</code> represents <code>bits_per_raw_sample + 1</code> for JPEG 2000 RCT or <code>bits_per_raw_sample</code> otherwise:<a href="#section-3.8-1" class="pilcrow">¶</a></p>
3026c3051
<             <div class="artwork art-svg alignLeft" id="section-3.8-2.1.1">
---
>             <div class="alignLeft art-svg artwork" id="section-3.8-2.1.1">
3266c3291
< <p id="section-3.8.1-1">Early experimental versions of FFV1 used the Context-Adaptive Binary Arithmetic Coding (CABAC) coder from H.264 as defined in <span>[<a href="#ISO.14496-10.2020" class="xref">ISO.14496-10.2020</a>]</span>, but due to the uncertain patent/royalty situation, as well as its slightly worse performance, CABAC was replaced by a range coder based on an algorithm defined by <span class="contact-name">G. Nigel N. Martin</span> in 1979 <span>[<a href="#Range-Encoding" class="xref">Range-Encoding</a>]</span>.<a href="#section-3.8.1-1" class="pilcrow">¶</a></p>
---
> <p id="section-3.8.1-1">Early experimental versions of FFV1 used the Context-Adaptive Binary Arithmetic Coding (CABAC) coder from H.264 as defined in <span>[<a href="#ISO.14496-10.2020" class="cite xref">ISO.14496-10.2020</a>]</span>, but due to the uncertain patent/royalty situation, as well as its slightly worse performance, CABAC was replaced by a range coder based on an algorithm defined by <span class="contact-name">G. Nigel N. Martin</span> in 1979 <span>[<a href="#Range-Encoding" class="cite xref">Range-Encoding</a>]</span>.<a href="#section-3.8.1-1" class="pilcrow">¶</a></p>
3326c3351
< <p id="section-3.8.1.1-4">The following range coder state variables are initialized to the following values. The Range is initialized to a value of 65,280 (expressed in base 16 as 0xFF00) as depicted in <a href="#figureInitializeRange" class="xref">Figure 11</a>. The Low is initialized according to the value of the first two bytes as depicted in <a href="#figureInitializeLow" class="xref">Figure 12</a>. j<sub>i</sub> tracks the length of the bytestream encoding while incrementing from an initial value of j<sub>0</sub> to a final value of j<sub>n</sub>. j<sub>0</sub> is initialized to 2 as depicted in <a href="#figureInitializeLength" class="xref">Figure 13</a>.<a href="#section-3.8.1.1-4" class="pilcrow">¶</a></p>
---
> <p id="section-3.8.1.1-4">The following range coder state variables are initialized to the following values. The Range is initialized to a value of 65,280 (expressed in base 16 as 0xFF00) as depicted in <a href="#figureInitializeRange" class="auto internal xref">Figure 11</a>. The Low is initialized according to the value of the first two bytes as depicted in <a href="#figureInitializeLow" class="auto internal xref">Figure 12</a>. j<sub>i</sub> tracks the length of the bytestream encoding while incrementing from an initial value of j<sub>0</sub> to a final value of j<sub>n</sub>. j<sub>0</sub> is initialized to 2 as depicted in <a href="#figureInitializeLength" class="auto internal xref">Figure 13</a>.<a href="#section-3.8.1.1-4" class="pilcrow">¶</a></p>
3330c3355
<                 <div class="artwork art-svg alignLeft" id="section-3.8.1.1-5.1.1">
---
>                 <div class="alignLeft art-svg artwork" id="section-3.8.1.1-5.1.1">
3398c3423
<                 <div class="artwork art-svg alignLeft" id="section-3.8.1.1-6.1.1">
---
>                 <div class="alignLeft art-svg artwork" id="section-3.8.1.1-6.1.1">
3480c3505
<                 <div class="artwork art-svg alignLeft" id="section-3.8.1.1-7.1.1">
---
>                 <div class="alignLeft art-svg artwork" id="section-3.8.1.1-7.1.1">
3533c3558
<                 <div class="artwork art-svg alignLeft" id="section-3.8.1.1-9.1.1">
---
>                 <div class="alignLeft art-svg artwork" id="section-3.8.1.1-9.1.1">
3644c3669
<                 <div class="artwork art-svg alignLeft" id="section-3.8.1.1-10.1.1">
---
>                 <div class="alignLeft art-svg artwork" id="section-3.8.1.1-10.1.1">
4070c4095
<                 <div class="artwork art-svg alignLeft" id="section-3.8.1.1-11.1.1">
---
>                 <div class="alignLeft art-svg artwork" id="section-3.8.1.1-11.1.1">
4181c4206
<                 <div class="artwork art-svg alignLeft" id="section-3.8.1.1-12.1.1">
---
>                 <div class="alignLeft art-svg artwork" id="section-3.8.1.1-12.1.1">
4473,4474c4498,4499
<               <div id="section-3.8.1.1-13.1">
< <pre class="sourcecode lang-c">
---
>               <div class="lang-c sourcecode" id="section-3.8.1.1-13.1">
> <pre>
4488,4489c4513,4514
<               <div id="section-3.8.1.1-14.1">
< <pre class="sourcecode lang-c">
---
>               <div class="lang-c sourcecode" id="section-3.8.1.1-14.1">
> <pre>
4509,4510c4534,4535
<               <div id="section-3.8.1.1-15.1">
< <pre class="sourcecode lang-c">
---
>               <div class="lang-c sourcecode" id="section-3.8.1.1-15.1">
> <pre>
4563c4588
< <p id="section-3.8.1.2-1">To encode scalar integers, it would be possible to encode each bit separately and use the past bits as context. However, that would mean 255 contexts per 8-bit symbol, which is not only a waste of memory but also requires more past data to reach a reasonably good estimate of the probabilities. Alternatively, it would also be possible to assume a Laplacian distribution and only deal with its variance and mean (as in Huffman coding). However, for maximum flexibility and simplicity, the chosen method uses a single symbol to encode if a number is 0, and if the number is nonzero, it encodes the number using its exponent, mantissa, and sign. The exact contexts used are best described by <a href="#figureRangeNonBinaryValueExample" class="xref">Figure 21</a>.<a href="#section-3.8.1.2-1" class="pilcrow">¶</a></p>
---
> <p id="section-3.8.1.2-1">To encode scalar integers, it would be possible to encode each bit separately and use the past bits as context. However, that would mean 255 contexts per 8-bit symbol, which is not only a waste of memory but also requires more past data to reach a reasonably good estimate of the probabilities. Alternatively, it would also be possible to assume a Laplacian distribution and only deal with its variance and mean (as in Huffman coding). However, for maximum flexibility and simplicity, the chosen method uses a single symbol to encode if a number is 0, and if the number is nonzero, it encodes the number using its exponent, mantissa, and sign. The exact contexts used are best described by <a href="#figureRangeNonBinaryValueExample" class="auto internal xref">Figure 21</a>.<a href="#section-3.8.1.2-1" class="pilcrow">¶</a></p>
4566,4567c4591,4592
<               <div id="section-3.8.1.2-2.1">
< <pre class="sourcecode lang-c">
---
>               <div class="lang-c sourcecode" id="section-3.8.1.2-2.1">
> <pre>
4599,4600c4624,4625
< <p id="section-3.8.1.2-3"><code>get_symbol</code> is used for the read out of <code>sample_difference</code> indicated in <a href="#figureSampleDifference" class="xref">Figure 10</a>.<a href="#section-3.8.1.2-3" class="pilcrow">¶</a></p>
< <p id="section-3.8.1.2-4"><code>get_rac</code> returns a boolean computed from the bytestream as described by the formula found in <a href="#figureGetRacFormula" class="xref">Figure 14</a> and by the pseudocode found in <a href="#figureGetRacPseudoCode" class="xref">Figure 20</a>.<a href="#section-3.8.1.2-4" class="pilcrow">¶</a></p>
---
> <p id="section-3.8.1.2-3"><code>get_symbol</code> is used for the read out of <code>sample_difference</code> indicated in <a href="#figureSampleDifference" class="auto internal xref">Figure 10</a>.<a href="#section-3.8.1.2-3" class="pilcrow">¶</a></p>
> <p id="section-3.8.1.2-4"><code>get_rac</code> returns a boolean computed from the bytestream as described by the formula found in <a href="#figureGetRacFormula" class="auto internal xref">Figure 14</a> and by the pseudocode found in <a href="#figureGetRacPseudoCode" class="auto internal xref">Figure 20</a>.<a href="#section-3.8.1.2-4" class="pilcrow">¶</a></p>
4608c4633
< <p id="section-3.8.1.3-1">When the <code>keyframe</code> value (see <a href="#frame" class="xref">Section 4.4</a>) is 1, all range coder state variables are set to their initial state.<a href="#section-3.8.1.3-1" class="pilcrow">¶</a></p>
---
> <p id="section-3.8.1.3-1">When the <code>keyframe</code> value (see <a href="#frame" class="auto internal xref">Section 4.4</a>) is 1, all range coder state variables are set to their initial state.<a href="#section-3.8.1.3-1" class="pilcrow">¶</a></p>
4616c4641
< <p id="section-3.8.1.4-1">In Range Coding Mode, a state transition table is used, indicating to which state the decoder will move based on the current state and the value extracted from <a href="#figureGetRacPseudoCode" class="xref">Figure 20</a>.<a href="#section-3.8.1.4-1" class="pilcrow">¶</a></p>
---
> <p id="section-3.8.1.4-1">In Range Coding Mode, a state transition table is used, indicating to which state the decoder will move based on the current state and the value extracted from <a href="#figureGetRacPseudoCode" class="auto internal xref">Figure 20</a>.<a href="#section-3.8.1.4-1" class="pilcrow">¶</a></p>
4620c4645
<                 <div class="artwork art-svg alignLeft" id="section-3.8.1.4-2.1.1">
---
>                 <div class="alignLeft art-svg artwork" id="section-3.8.1.4-2.1.1">
4802c4827
<                 <div class="artwork art-svg alignLeft" id="section-3.8.1.4-3.1.1">
---
>                 <div class="alignLeft art-svg artwork" id="section-3.8.1.4-3.1.1">
4963c4988
<               <div class="artwork art-text alignLeft art-ascii-art" id="section-3.8.1.5-2.1">
---
>               <div class="alignLeft art-ascii-art art-text artwork" id="section-3.8.1.5-2.1">
5009c5034
< <p id="section-3.8.1.6-1">The alternative state transition table has been built using iterative minimization of frame sizes and generally performs better than the default. To use it, the <code>coder_type</code> (see <a href="#coder-type" class="xref">Section 4.2.3</a>) <span class="bcp14">MUST</span> be set to 2, and the difference to the default <span class="bcp14">MUST</span> be stored in the <code>Parameters</code>, see <a href="#parameters" class="xref">Section 4.2</a>. At the time of this writing, the reference implementation of FFV1 in FFmpeg uses <a href="#figureAltStateTransition" class="xref">Figure 25</a> by default when Range coding is used.<a href="#section-3.8.1.6-1" class="pilcrow">¶</a></p>
---
> <p id="section-3.8.1.6-1">The alternative state transition table has been built using iterative minimization of frame sizes and generally performs better than the default. To use it, the <code>coder_type</code> (see <a href="#coder-type" class="auto internal xref">Section 4.2.3</a>) <span class="bcp14">MUST</span> be set to 2, and the difference to the default <span class="bcp14">MUST</span> be stored in the <code>Parameters</code>, see <a href="#parameters" class="auto internal xref">Section 4.2</a>. At the time of this writing, the reference implementation of FFV1 in FFmpeg uses <a href="#figureAltStateTransition" class="auto internal xref">Figure 25</a> by default when Range coding is used.<a href="#section-3.8.1.6-1" class="pilcrow">¶</a></p>
5012c5037
<               <div class="artwork art-text alignLeft art-ascii-art" id="section-3.8.1.6-2.1">
---
>               <div class="alignLeft art-ascii-art art-text artwork" id="section-3.8.1.6-2.1">
5066c5091
< <p id="section-3.8.2.1-1">This coding mode uses Golomb Rice codes. The VLC is split into two parts: the prefix and suffix. The prefix stores the most significant bits or indicates if the symbol is too large to be stored (this is known as the ESC case, see <a href="#prefix" class="xref">Section 3.8.2.1.1</a>). The suffix either stores the k least significant bits or stores the whole number in the ESC case.<a href="#section-3.8.2.1-1" class="pilcrow">¶</a></p>
---
> <p id="section-3.8.2.1-1">This coding mode uses Golomb Rice codes. The VLC is split into two parts: the prefix and suffix. The prefix stores the most significant bits or indicates if the symbol is too large to be stored (this is known as the ESC case, see <a href="#prefix" class="auto internal xref">Section 3.8.2.1.1</a>). The suffix either stores the k least significant bits or stores the whole number in the ESC case.<a href="#section-3.8.2.1-1" class="pilcrow">¶</a></p>
5068,5069c5093,5094
<               <div id="section-3.8.2.1-2.1">
< <pre class="sourcecode lang-c">
---
>               <div class="lang-c sourcecode" id="section-3.8.2.1-2.1">
> <pre>
5084,5085c5109,5110
<               <div id="section-3.8.2.1-3.1">
< <pre class="sourcecode lang-c">
---
>               <div class="lang-c sourcecode" id="section-3.8.2.1-3.1">
> <pre>
5179c5204
< <p id="section-3.8.2.1.3-1"><a href="#tableGolombExamples" class="xref">Table 3</a> shows practical examples of how signed Golomb Rice codes are decoded based on the series of bits extracted from the bitstream as described by the method above:<a href="#section-3.8.2.1.3-1" class="pilcrow">¶</a></p>
---
> <p id="section-3.8.2.1.3-1"><a href="#tableGolombExamples" class="auto internal xref">Table 3</a> shows practical examples of how signed Golomb Rice codes are decoded based on the series of bits extracted from the bitstream as described by the method above:<a href="#section-3.8.2.1.3-1" class="pilcrow">¶</a></p>
5248c5273
< <p id="section-3.8.2.2-1">Run mode is entered when the context is 0 and left as soon as a nonzero difference is found. The Sample Difference is identical to the predicted one. The run and the first different Sample Difference are coded as defined in <a href="#golomb-rice-sample-difference-coding" class="xref">Section 3.8.2.4.1</a>.<a href="#section-3.8.2.2-1" class="pilcrow">¶</a></p>
---
> <p id="section-3.8.2.2-1">Run mode is entered when the context is 0 and left as soon as a nonzero difference is found. The Sample Difference is identical to the predicted one. The run and the first different Sample Difference are coded as defined in <a href="#golomb-rice-sample-difference-coding" class="auto internal xref">Section 3.8.2.4.1</a>.<a href="#section-3.8.2.2-1" class="pilcrow">¶</a></p>
5255,5256c5280,5281
< <div id="section-3.8.2.2.1-2">
< <pre class="sourcecode lang-c">
---
> <div class="lang-c sourcecode" id="section-3.8.2.2.1-2">
> <pre>
5286c5311
< <p id="section-3.8.2.2.1-3">The <code>log2_run</code> array is also used within <span>[<a href="#ISO.14495-1.1999" class="xref">ISO.14495-1.1999</a>]</span>.<a href="#section-3.8.2.2.1-3" class="pilcrow">¶</a></p>
---
> <p id="section-3.8.2.2.1-3">The <code>log2_run</code> array is also used within <span>[<a href="#ISO.14495-1.1999" class="cite xref">ISO.14495-1.1999</a>]</span>.<a href="#section-3.8.2.2.1-3" class="pilcrow">¶</a></p>
5297,5298c5322,5323
< <div id="section-3.8.2.3-2">
< <pre class="sourcecode lang-c">
---
> <div class="lang-c sourcecode" id="section-3.8.2.3-2">
> <pre>
5318,5319c5343,5344
< <div id="section-3.8.2.4-2">
< <pre class="sourcecode lang-c">
---
> <div class="lang-c sourcecode" id="section-3.8.2.4-2">
> <pre>
5366,5367c5391,5392
< <div id="section-3.8.2.4.1-2">
< <pre class="sourcecode lang-c">
---
> <div class="lang-c sourcecode" id="section-3.8.2.4.1-2">
> <pre>
5384,5386c5409,5411
< <p id="section-3.8.2.5-1">When <code>keyframe</code> (see <a href="#frame" class="xref">Section 4.4</a>) value is 1, all VLC coder state variables are set to their initial state.<a href="#section-3.8.2.5-1" class="pilcrow">¶</a></p>
< <div id="section-3.8.2.5-2">
< <pre class="sourcecode lang-c">
---
> <p id="section-3.8.2.5-1">When <code>keyframe</code> (see <a href="#frame" class="auto internal xref">Section 4.4</a>) value is 1, all VLC coder state variables are set to their initial state.<a href="#section-3.8.2.5-1" class="pilcrow">¶</a></p>
> <div class="lang-c sourcecode" id="section-3.8.2.5-2">
> <pre>
5407c5432
< <p id="section-4-2">Within the following subsections, pseudocode as described in <a href="#pseudocode" class="xref">Section 2.2.1</a> is used to explain the structure of each FFV1 bitstream component. <a href="#tablePseudoCodeSymbols" class="xref">Table 4</a> lists symbols used to annotate that pseudocode in order to define the storage of the data referenced in that line of pseudocode.<a href="#section-4-2" class="pilcrow">¶</a></p>
---
> <p id="section-4-2">Within the following subsections, pseudocode as described in <a href="#pseudocode" class="auto internal xref">Section 2.2.1</a> is used to explain the structure of each FFV1 bitstream component. <a href="#tablePseudoCodeSymbols" class="auto internal xref">Table 4</a> lists symbols used to annotate that pseudocode in order to define the storage of the data referenced in that line of pseudocode.<a href="#section-4-2" class="pilcrow">¶</a></p>
5427c5452
<             <td class="text-left" rowspan="1" colspan="1">Boolean (1-bit) symbol that is range coded with the method described in <a href="#range-binary-values" class="xref">Section 3.8.1.1</a>
---
>             <td class="text-left" rowspan="1" colspan="1">Boolean (1-bit) symbol that is range coded with the method described in <a href="#range-binary-values" class="auto internal xref">Section 3.8.1.1</a>
5432c5457
<             <td class="text-left" rowspan="1" colspan="1">Unsigned scalar symbol that is range coded with the method described in <a href="#range-nonbinary-values" class="xref">Section 3.8.1.2</a>
---
>             <td class="text-left" rowspan="1" colspan="1">Unsigned scalar symbol that is range coded with the method described in <a href="#range-nonbinary-values" class="auto internal xref">Section 3.8.1.2</a>
5437c5462
<             <td class="text-left" rowspan="1" colspan="1">Signed scalar symbol that is range coded with the method described in <a href="#range-nonbinary-values" class="xref">Section 3.8.1.2</a>
---
>             <td class="text-left" rowspan="1" colspan="1">Signed scalar symbol that is range coded with the method described in <a href="#range-nonbinary-values" class="auto internal xref">Section 3.8.1.2</a>
5442c5467
<             <td class="text-left" rowspan="1" colspan="1">Sample Difference symbol that is coded with the method described in <a href="#coding-of-the-sample-difference" class="xref">Section 3.8</a>
---
>             <td class="text-left" rowspan="1" colspan="1">Sample Difference symbol that is coded with the method described in <a href="#coding-of-the-sample-difference" class="auto internal xref">Section 3.8</a>
5458c5483
< <p id="section-4.1-1">The Quantization Table Sets store a sequence of values that are equal to one less than the count of equal concurrent entries for each set of equal concurrent entries within the first half of the table (represented as <code>len - 1</code> in the pseudocode below) using the method described in <a href="#range-nonbinary-values" class="xref">Section 3.8.1.2</a>. The second half doesn't need to be stored as it is identical to the first with flipped sign. <code>scale</code> and <code>len_count[ i ][ j ]</code> are temporary values used for the computing of <code>context_count[ i ]</code> and are not used outside Quantization Table Set pseudocode.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
---
> <p id="section-4.1-1">The Quantization Table Sets store a sequence of values that are equal to one less than the count of equal concurrent entries for each set of equal concurrent entries within the first half of the table (represented as <code>len - 1</code> in the pseudocode below) using the method described in <a href="#range-nonbinary-values" class="auto internal xref">Section 3.8.1.2</a>. The second half doesn't need to be stored as it is identical to the first with flipped sign. <code>scale</code> and <code>len_count[ i ][ j ]</code> are temporary values used for the computing of <code>context_count[ i ]</code> and are not used outside Quantization Table Set pseudocode.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
5463,5464c5488,5489
< <div id="section-4.1-6">
< <pre class="sourcecode lang-pseudocode">
---
> <div class="lang-pseudocode sourcecode" id="section-4.1-6">
> <pre>
5478,5479c5503,5504
< <div id="section-4.1-8">
< <pre class="sourcecode lang-pseudocode">
---
> <div class="lang-pseudocode sourcecode" id="section-4.1-8">
> <pre>
5525c5550
< <p id="section-4.2-1">The <code>Parameters</code> section, which could be in a global header of a container file that may or may not be considered to be part of the bitstream, contains significant characteristics about the decoding configuration used for all instances of Frame (in FFV1 versions 0 and 1) or the whole FFV1 bitstream (other versions), including the stream version, color configuration, and Quantization Tables. <a href="#figureBitstream" class="xref">Figure 28</a> describes the contents of the bitstream.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
---
> <p id="section-4.2-1">The <code>Parameters</code> section, which could be in a global header of a container file that may or may not be considered to be part of the bitstream, contains significant characteristics about the decoding configuration used for all instances of Frame (in FFV1 versions 0 and 1) or the whole FFV1 bitstream (other versions), including the stream version, color configuration, and Quantization Tables. <a href="#figureBitstream" class="auto internal xref">Figure 28</a> describes the contents of the bitstream.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
5529,5530c5554,5555
<           <div id="section-4.2-3.1">
< <pre class="sourcecode lang-pseudocode">
---
>           <div class="lang-pseudocode sourcecode" id="section-4.2-3.1">
> <pre>
5951c5976
<               <div class="artwork art-svg alignLeft" id="section-4.2.15-2.1.1">
---
>               <div class="alignLeft art-svg artwork" id="section-4.2.15-2.1.1">
6099c6124
<               <div class="artwork art-svg alignLeft" id="section-4.2.15-3.1.1">
---
>               <div class="alignLeft art-svg artwork" id="section-4.2.15-3.1.1">
6373,6375c6398,6400
< <p id="section-4.3-1">In the case of a FFV1 bitstream with <code>version &gt;= 3</code>, a <code>Configuration Record</code> is stored in the underlying container as described in <a href="#mapping-ffv1-into-containers" class="xref">Section 4.3.3</a>. It contains the <code>Parameters</code> used for all instances of Frame. The size of the <code>Configuration Record</code>, <code>NumBytes</code>, is supplied by the underlying container.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
< <div id="section-4.3-2">
< <pre class="sourcecode lang-pseudocode">
---
> <p id="section-4.3-1">In the case of a FFV1 bitstream with <code>version &gt;= 3</code>, a <code>Configuration Record</code> is stored in the underlying container as described in <a href="#mapping-ffv1-into-containers" class="auto internal xref">Section 4.3.3</a>. It contains the <code>Parameters</code> used for all instances of Frame. The size of the <code>Configuration Record</code>, <code>NumBytes</code>, is supplied by the underlying container.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
> <div class="lang-pseudocode sourcecode" id="section-4.3-2">
> <pre>
6405c6430
< <p id="section-4.3.2-3">The CRC generator polynomial used is described in <a href="#slice-crc-parity" class="xref">Section 4.9.3</a>.<a href="#section-4.3.2-3" class="pilcrow">¶</a></p>
---
> <p id="section-4.3.2-3">The CRC generator polynomial used is described in <a href="#slice-crc-parity" class="auto internal xref">Section 4.9.3</a>.<a href="#section-4.3.2-3" class="pilcrow">¶</a></p>
6420c6445
< <p id="section-4.3.3.1-2">See <span>[<a href="#AVI" class="xref">AVI</a>]</span> for more information about chunks.<a href="#section-4.3.3.1-2" class="pilcrow">¶</a></p>
---
> <p id="section-4.3.3.1-2">See <span>[<a href="#AVI" class="cite xref">AVI</a>]</span> for more information about chunks.<a href="#section-4.3.3.1-2" class="pilcrow">¶</a></p>
6429c6454
< <p id="section-4.3.3.2-1">The <code>Configuration Record</code> extends the sample description box ("moov", "trak", "mdia", "minf", "stbl", "stsd") with a "glbl" box that contains the <code>ConfigurationRecord</code> bitstream. See <span>[<a href="#ISO.14496-12.2020" class="xref">ISO.14496-12.2020</a>]</span> for more information about boxes.<a href="#section-4.3.3.2-1" class="pilcrow">¶</a></p>
---
> <p id="section-4.3.3.2-1">The <code>Configuration Record</code> extends the sample description box ("moov", "trak", "mdia", "minf", "stbl", "stsd") with a "glbl" box that contains the <code>ConfigurationRecord</code> bitstream. See <span>[<a href="#ISO.14496-12.2020" class="cite xref">ISO.14496-12.2020</a>]</span> for more information about boxes.<a href="#section-4.3.3.2-1" class="pilcrow">¶</a></p>
6438c6463
< <p id="section-4.3.3.3-1">The <code>codec_specific_data</code> element (in <code>stream_header</code> packet) contains the <code>ConfigurationRecord</code> bitstream. See <span>[<a href="#NUT" class="xref">NUT</a>]</span> for more information about elements.<a href="#section-4.3.3.3-1" class="pilcrow">¶</a></p>
---
> <p id="section-4.3.3.3-1">The <code>codec_specific_data</code> element (in <code>stream_header</code> packet) contains the <code>ConfigurationRecord</code> bitstream. See <span>[<a href="#NUT" class="cite xref">NUT</a>]</span> for more information about elements.<a href="#section-4.3.3.3-1" class="pilcrow">¶</a></p>
6447c6472
< <p id="section-4.3.3.4-1">FFV1 <span class="bcp14">SHOULD</span> use <code>V_FFV1</code> as the Matroska <code>Codec ID</code>. For FFV1 versions 2 or less, the Matroska <code>CodecPrivate</code> Element <span class="bcp14">SHOULD NOT</span> be used. For FFV1 versions 3 or greater, the Matroska <code>CodecPrivate</code> Element <span class="bcp14">MUST</span> contain the FFV1 <code>Configuration Record</code> structure and no other data. See <span>[<a href="#I-D.ietf-cellar-matroska" class="xref">Matroska</a>]</span> for more information about elements.<a href="#section-4.3.3.4-1" class="pilcrow">¶</a></p>
---
> <p id="section-4.3.3.4-1">FFV1 <span class="bcp14">SHOULD</span> use <code>V_FFV1</code> as the Matroska <code>Codec ID</code>. For FFV1 versions 2 or less, the Matroska <code>CodecPrivate</code> Element <span class="bcp14">SHOULD NOT</span> be used. For FFV1 versions 3 or greater, the Matroska <code>CodecPrivate</code> Element <span class="bcp14">MUST</span> contain the FFV1 <code>Configuration Record</code> structure and no other data. See <span>[<a href="#I-D.ietf-cellar-matroska" class="cite xref">Matroska</a>]</span> for more information about elements.<a href="#section-4.3.3.4-1" class="pilcrow">¶</a></p>
6463,6464c6488,6489
< <div id="section-4.4-4">
< <pre class="sourcecode lang-pseudocode">
---
> <div class="lang-pseudocode sourcecode" id="section-4.4-4">
> <pre>
6479c6504
< <div class="artwork art-text alignCenter" id="section-4.4-6">
---
> <div class="alignCenter art-text artwork" id="section-4.4-6">
6519,6520c6544,6545
< <div id="section-4.5-3">
< <pre class="sourcecode lang-pseudocode">
---
> <div class="lang-pseudocode sourcecode" id="section-4.5-3">
> <pre>
6558,6559c6583,6584
< <div id="section-4.6-3">
< <pre class="sourcecode lang-pseudocode">
---
> <div class="lang-pseudocode sourcecode" id="section-4.6-3">
> <pre>
6618c6643
< <div class="artwork art-text alignLeft art-ascii-art" id="section-4.6.5-2">
---
> <div class="alignLeft art-ascii-art art-text artwork" id="section-4.6.5-2">
6713,6714c6738,6739
< <div id="section-4.7-3">
< <pre class="sourcecode lang-pseudocode">
---
> <div class="lang-pseudocode sourcecode" id="section-4.7-3">
> <pre>
6740c6765
< <div class="artwork art-text alignLeft art-ascii-art" id="section-4.7.1-2">
---
> <div class="alignLeft art-ascii-art art-text artwork" id="section-4.7.1-2">
6753c6778
< <div class="artwork art-text alignLeft art-ascii-art" id="section-4.7.2-2">
---
> <div class="alignLeft art-ascii-art art-text artwork" id="section-4.7.2-2">
6768c6793
< <div class="artwork art-text alignLeft art-ascii-art" id="section-4.7.3-2">
---
> <div class="alignLeft art-ascii-art art-text artwork" id="section-4.7.3-2">
6785c6810
< <div class="artwork art-text alignLeft art-ascii-art" id="section-4.7.4-2">
---
> <div class="alignLeft art-ascii-art art-text artwork" id="section-4.7.4-2">
6800,6801c6825,6826
< <div id="section-4.8-2">
< <pre class="sourcecode lang-pseudocode">
---
> <div class="lang-pseudocode sourcecode" id="section-4.8-2">
> <pre>
6823c6848
< <div class="artwork art-text alignLeft art-ascii-art" id="section-4.8.1-2">
---
> <div class="alignLeft art-ascii-art art-text artwork" id="section-4.8.1-2">
6838c6863
< <div class="artwork art-text alignLeft art-ascii-art" id="section-4.8.2-2">
---
> <div class="alignLeft art-ascii-art art-text artwork" id="section-4.8.2-2">
6855c6880
< <div class="artwork art-text alignLeft art-ascii-art" id="section-4.8.3-2">
---
> <div class="alignLeft art-ascii-art art-text artwork" id="section-4.8.3-2">
6867c6892
< <p id="section-4.8.4-1"><code>sample_difference[ p ][ y ][ x ]</code> is the Sample Difference for Sample at Plane <code>p</code>, y position <code>y</code>, and x position <code>x</code>. The Sample value is computed based on median predictor and context described in <a href="#samples" class="xref">Section 3.2</a>.<a href="#section-4.8.4-1" class="pilcrow">¶</a></p>
---
> <p id="section-4.8.4-1"><code>sample_difference[ p ][ y ][ x ]</code> is the Sample Difference for Sample at Plane <code>p</code>, y position <code>y</code>, and x position <code>x</code>. The Sample value is computed based on median predictor and context described in <a href="#samples" class="auto internal xref">Section 3.2</a>.<a href="#section-4.8.4-1" class="pilcrow">¶</a></p>
6879,6880c6904,6905
< <div id="section-4.9-3">
< <pre class="sourcecode lang-pseudocode">
---
> <div class="lang-pseudocode sourcecode" id="section-4.9-3">
> <pre>
6971,6972c6996,6997
< <p id="section-6-1">Like any other codec (such as <span>[<a href="#RFC6716" class="xref">RFC6716</a>]</span>), FFV1 should not be used with insecure ciphers or cipher modes that are vulnerable to known plaintext attacks. Some of the header bits as well as the padding are easily predictable.<a href="#section-6-1" class="pilcrow">¶</a></p>
< <p id="section-6-2">Implementations of the FFV1 codec need to take appropriate security considerations into account. Those related to denial of service are outlined in <span><a href="https://www.rfc-editor.org/rfc/rfc4732#section-2.1" class="relref">Section 2.1</a> of [<a href="#RFC4732" class="xref">RFC4732</a>]</span>. It is extremely important for the decoder to be robust against malicious payloads. Malicious payloads <span class="bcp14">MUST NOT</span> cause the decoder to overrun its allocated memory or to take an excessive amount of resources to decode. An overrun in allocated memory could lead to arbitrary code execution by an attacker. The same applies to the encoder, even though problems in encoders are typically rarer. Malicious video streams <span class="bcp14">MUST NOT</span> cause the encoder to misbehave because this would allow an attacker to attack transcoding gateways. A frequent security problem in image and video codecs is failure to check for integer overflows. An example is allocating <code>frame_pixel_width * frame_pixel_height</code> in pixel count computations without considering that the multiplication result may have overflowed the range of the arithmetic type.
---
> <p id="section-6-1">Like any other codec (such as <span>[<a href="#RFC6716" class="cite xref">RFC6716</a>]</span>), FFV1 should not be used with insecure ciphers or cipher modes that are vulnerable to known plaintext attacks. Some of the header bits as well as the padding are easily predictable.<a href="#section-6-1" class="pilcrow">¶</a></p>
> <p id="section-6-2">Implementations of the FFV1 codec need to take appropriate security considerations into account. Those related to denial of service are outlined in <span><a href="https://rfc-editor.org/rfc/rfc4732#section-2.1" class="relref">Section 2.1</a> of [<a href="#RFC4732" class="cite xref">RFC4732</a>]</span>. It is extremely important for the decoder to be robust against malicious payloads. Malicious payloads <span class="bcp14">MUST NOT</span> cause the decoder to overrun its allocated memory or to take an excessive amount of resources to decode. An overrun in allocated memory could lead to arbitrary code execution by an attacker. The same applies to the encoder, even though problems in encoders are typically rarer. Malicious video streams <span class="bcp14">MUST NOT</span> cause the encoder to misbehave because this would allow an attacker to attack transcoding gateways. A frequent security problem in image and video codecs is failure to check for integer overflows. An example is allocating <code>frame_pixel_width * frame_pixel_height</code> in pixel count computations without considering that the multiplication result may have overflowed the range of the arithmetic type.
6988c7013
< <p id="section-7.1-1">This registration is done using the template defined in <span>[<a href="#RFC6838" class="xref">RFC6838</a>]</span> and following <span>[<a href="#RFC4855" class="xref">RFC4855</a>]</span>.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
---
> <p id="section-7.1-1">This registration is done using the template defined in <span>[<a href="#RFC6838" class="cite xref">RFC6838</a>]</span> and following <span>[<a href="#RFC4855" class="cite xref">RFC4855</a>]</span>.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
7008c7033
<               <dd style="margin-left: 1.5em" id="section-7.1-2.8.2.2">The <code>version</code> of the FFV1 encoding as defined by <a href="#version" class="xref">Section 4.2.1</a>.<a href="#section-7.1-2.8.2.2" class="pilcrow">¶</a>
---
>               <dd style="margin-left: 1.5em" id="section-7.1-2.8.2.2">The <code>version</code> of the FFV1 encoding as defined by <a href="#version" class="auto internal xref">Section 4.2.1</a>.<a href="#section-7.1-2.8.2.2" class="pilcrow">¶</a>
7013c7038
<               <dd style="margin-left: 1.5em" id="section-7.1-2.8.2.4">The <code>micro_version</code> of the FFV1 encoding as defined by <a href="#micro-version" class="xref">Section 4.2.2</a>.<a href="#section-7.1-2.8.2.4" class="pilcrow">¶</a>
---
>               <dd style="margin-left: 1.5em" id="section-7.1-2.8.2.4">The <code>micro_version</code> of the FFV1 encoding as defined by <a href="#micro-version" class="auto internal xref">Section 4.2.2</a>.<a href="#section-7.1-2.8.2.4" class="pilcrow">¶</a>
7018c7043
<               <dd style="margin-left: 1.5em" id="section-7.1-2.8.2.6">The <code>coder_type</code> of the FFV1 encoding as defined by <a href="#coder-type" class="xref">Section 4.2.3</a>.<a href="#section-7.1-2.8.2.6" class="pilcrow">¶</a>
---
>               <dd style="margin-left: 1.5em" id="section-7.1-2.8.2.6">The <code>coder_type</code> of the FFV1 encoding as defined by <a href="#coder-type" class="auto internal xref">Section 4.2.3</a>.<a href="#section-7.1-2.8.2.6" class="pilcrow">¶</a>
7023c7048
<               <dd style="margin-left: 1.5em" id="section-7.1-2.8.2.8">The <code>colorspace_type</code> of the FFV1 encoding as defined by <a href="#colorspace-type" class="xref">Section 4.2.5</a>.<a href="#section-7.1-2.8.2.8" class="pilcrow">¶</a>
---
>               <dd style="margin-left: 1.5em" id="section-7.1-2.8.2.8">The <code>colorspace_type</code> of the FFV1 encoding as defined by <a href="#colorspace-type" class="auto internal xref">Section 4.2.5</a>.<a href="#section-7.1-2.8.2.8" class="pilcrow">¶</a>
7028c7053
<               <dd style="margin-left: 1.5em" id="section-7.1-2.8.2.10">The <code>bits_per_raw_sample</code> of the FFV1 encoding as defined by <a href="#bits-per-raw-sample" class="xref">Section 4.2.7</a>.<a href="#section-7.1-2.8.2.10" class="pilcrow">¶</a>
---
>               <dd style="margin-left: 1.5em" id="section-7.1-2.8.2.10">The <code>bits_per_raw_sample</code> of the FFV1 encoding as defined by <a href="#bits-per-raw-sample" class="auto internal xref">Section 4.2.7</a>.<a href="#section-7.1-2.8.2.10" class="pilcrow">¶</a>
7040c7065
<           <dd style="margin-left: 1.5em" id="section-7.1-2.10">This media type is defined for encapsulation in several audiovisual container formats and contains binary data; see <a href="#mapping-ffv1-into-containers" class="xref">Section 4.3.3</a>. This media type is framed binary data; see <span><a href="https://www.rfc-editor.org/rfc/rfc6838#section-4.8" class="relref">Section 4.8</a> of [<a href="#RFC6838" class="xref">RFC6838</a>]</span>.<a href="#section-7.1-2.10" class="pilcrow">¶</a>
---
>           <dd style="margin-left: 1.5em" id="section-7.1-2.10">This media type is defined for encapsulation in several audiovisual container formats and contains binary data; see <a href="#mapping-ffv1-into-containers" class="auto internal xref">Section 4.3.3</a>. This media type is framed binary data; see <span><a href="https://rfc-editor.org/rfc/rfc6838#section-4.8" class="relref">Section 4.8</a> of [<a href="#RFC6838" class="cite xref">RFC6838</a>]</span>.<a href="#section-7.1-2.10" class="pilcrow">¶</a>
7044c7069
<           <dd style="margin-left: 1.5em" id="section-7.1-2.12">See <a href="#security-considerations" class="xref">Section 6</a> of this document.<a href="#section-7.1-2.12" class="pilcrow">¶</a>
---
>           <dd style="margin-left: 1.5em" id="section-7.1-2.12">See <a href="#security-considerations" class="auto internal xref">Section 6</a> of this document.<a href="#section-7.1-2.12" class="pilcrow">¶</a>
7242,7243c7267,7268
< <p id="appendix-C.1-1">This reference implementation <span>[<a href="#REFIMPL" class="xref">REFIMPL</a>]</span> contains no known buffer overflow or cases where a specially crafted packet or video segment could cause a significant increase in CPU load.<a href="#appendix-C.1-1" class="pilcrow">¶</a></p>
< <p id="appendix-C.1-2">The reference implementation <span>[<a href="#REFIMPL" class="xref">REFIMPL</a>]</span> was validated in the following conditions:<a href="#appendix-C.1-2" class="pilcrow">¶</a></p>
---
> <p id="appendix-C.1-1">This reference implementation <span>[<a href="#REFIMPL" class="cite xref">REFIMPL</a>]</span> contains no known buffer overflow or cases where a specially crafted packet or video segment could cause a significant increase in CPU load.<a href="#appendix-C.1-1" class="pilcrow">¶</a></p>
> <p id="appendix-C.1-2">The reference implementation <span>[<a href="#REFIMPL" class="cite xref">REFIMPL</a>]</span> was validated in the following conditions:<a href="#appendix-C.1-2" class="pilcrow">¶</a></p>
7252c7277
< <p id="appendix-C.1-4">In all of the conditions above, the decoder and encoder was run inside the Valgrind memory debugger <span>[<a href="#Valgrind" class="xref">Valgrind</a>]</span> as well as the Clang AddressSanitizer <span>[<a href="#AddressSanitizer" class="xref">AddressSanitizer</a>]</span>, which tracks reads and writes to invalid memory regions as well as the use of uninitialized memory.  There were no errors reported on any of the tested conditions.<a href="#appendix-C.1-4" class="pilcrow">¶</a></p>
---
> <p id="appendix-C.1-4">In all of the conditions above, the decoder and encoder was run inside the Valgrind memory debugger <span>[<a href="#Valgrind" class="cite xref">Valgrind</a>]</span> as well as the Clang AddressSanitizer <span>[<a href="#AddressSanitizer" class="cite xref">AddressSanitizer</a>]</span>, which tracks reads and writes to invalid memory regions as well as the use of uninitialized memory.  There were no errors reported on any of the tested conditions.<a href="#appendix-C.1-4" class="pilcrow">¶</a></p>
7260c7285
< <p id="appendix-C.2-1">An FFV1 decoder <span>[<a href="#FFV1GO" class="xref">FFV1GO</a>]</span> was written in Go by Derek Buitenhuis during the work to develop this document.<a href="#appendix-C.2-1" class="pilcrow">¶</a></p>
---
> <p id="appendix-C.2-1">An FFV1 decoder <span>[<a href="#FFV1GO" class="cite xref">FFV1GO</a>]</span> was written in Go by Derek Buitenhuis during the work to develop this document.<a href="#appendix-C.2-1" class="pilcrow">¶</a></p>
7268c7293
< <p id="appendix-C.3-1">The developers of the MediaConch project <span>[<a href="#MediaConch" class="xref">MediaConch</a>]</span> created an independent FFV1 decoder as part of that project to validate FFV1 bitstreams. This work led to the discovery of three conflicts between existing FFV1 implementations and draft versions of this document. These issues are addressed by <a href="#exception" class="xref">Section 3.3.1</a>, <a href="#rgb-exception" class="xref">Section 3.7.2.1</a>, and <a href="#future-handling-of-some-streams-created-by-nonconforming-encoders" class="xref">Appendix B</a>.<a href="#appendix-C.3-1" class="pilcrow">¶</a></p>
---
> <p id="appendix-C.3-1">The developers of the MediaConch project <span>[<a href="#MediaConch" class="cite xref">MediaConch</a>]</span> created an independent FFV1 decoder as part of that project to validate FFV1 bitstreams. This work led to the discovery of three conflicts between existing FFV1 implementations and draft versions of this document. These issues are addressed by <a href="#exception" class="auto internal xref">Section 3.3.1</a>, <a href="#rgb-exception" class="auto internal xref">Section 3.7.2.1</a>, and <a href="#future-handling-of-some-streams-created-by-nonconforming-encoders" class="auto internal xref">Appendix B</a>.<a href="#appendix-C.3-1" class="pilcrow">¶</a></p>
