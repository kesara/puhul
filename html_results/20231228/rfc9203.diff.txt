17c17
< <meta content="xml2rfc 3.14.2" name="generator">
---
> <meta content="xml2rfc 3.19.0" name="generator">
25,30c25,28
<   xml2rfc 3.14.2
<     Python 3.9.13
<     appdirs 1.4.4
<     ConfigArgParse 1.5.3
<     google-i18n-address 2.5.1
<     html5lib 1.1
---
>   xml2rfc 3.19.0
>     Python 3.11.7
>     ConfigArgParse 1.7
>     google-i18n-address 3.1.0
33,39c31,36
<     kitchen 1.2.6
<     lxml 4.9.0
<     MarkupSafe 2.1.1
<     pycountry 22.3.5
<     PyYAML 6.0
<     requests 2.28.0
<     setuptools 44.1.1
---
>     lxml 4.9.4
>     platformdirs 4.1.0
>     pycountry 23.12.11
>     PyYAML 6.0.1
>     requests 2.31.0
>     setuptools 65.5.0
41c38
<     weasyprint 56.1
---
>     wcwidth 0.2.12
43c40
< <link href="rfc9203.xml" rel="alternate" type="application/rfc+xml">
---
> <link href="rfc/rfc9203.xml" rel="alternate" type="application/rfc+xml">
53c50
<   commented changes found necssary during the development of the v3
---
>   commented changes found necessary during the development of the v3
62a60,65
> :root {
>   --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
>   --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
>   --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
> }
> 
65d67
<   width: extend-to-zoom;
80c82
<   font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
---
>   font-family: var(--font-sans);
82a85
>   overflow-wrap: break-word;
168a172,180
> svg[font-family~="serif" i], svg [font-family~="serif" i] {
>   font-family: var(--font-serif);
> }
> svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
>   font-family: var(--font-sans);
> }
> svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
>   font-family: var(--font-mono);
> }
262c274
< tt, code, pre, code {
---
> tt, code, pre {
264c276
<   font-family: 'Roboto Mono', monospace;
---
>   font-family: var(--font-mono);
303a316,318
> blockquote > *:last-child {
>   margin-bottom: 0;
> }
501c516
<   font-family: "Noto Sans",Arial,Helvetica,sans-serif;
---
>   font-family: var(--font-sans);
641d655
< 
664c678
<   pre.breakable {
---
>   .breakable pre {
734c748
<   /* The follwing is commented out here, but set appropriately by in code, as
---
>   /* The following is commented out here, but set appropriately by in code, as
834c848
< tt, code, pre, code {
---
> tt, code, pre {
839c853
< pre.sourcecode,
---
> .sourcecode pre,
875c889
< /* Make the alternative author contact informatio look less like just another
---
> /* Make the alternative author contact information look less like just another
1056a1071
>   .artwork > pre,
1071c1086
< and increase the contrast between border and odd row background sligthtly */
---
> and increase the contrast between border and odd row background slightly */
1131c1146
< /* Text in compact lists should not get extra bottim margin space,
---
> /* Text in compact lists should not get extra bottom margin space,
1156c1171
< /* Tweak the comact list text */
---
> /* Tweak the compact list text */
1174c1189
< dd > div:first-child > pre.sourcecode,
---
> dd > div.sourcecode:first-child,
1188c1203
< li > p:last-of-type {
---
> li > p:last-of-type:only-child {
1192a1208
> <link href="https://datatracker.ietf.org/doc/draft-ietf-ace-oscore-profile-19" rel="prev">
1195c1211
<   <link href="https://datatracker.ietf.org/doc/draft-ietf-ace-oscore-profile-19" rel="prev">
---
>   <script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
1197,1198c1213,1214
< <body>
< <script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
---
> <body class="xml2rfc">
> <script src="metadata.min.js"></script>
1301c1317
<             <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
---
>             <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
1304c1320
<                 <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
---
>                 <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
1309c1325
<             <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-protocol-overview" class="xref">Protocol Overview</a></p>
---
>             <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-protocol-overview" class="internal xref">Protocol Overview</a></p>
1312c1328
<             <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-client-as-communication" class="xref">Client-AS Communication</a></p>
---
>             <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-client-as-communication" class="internal xref">Client-AS Communication</a></p>
1315c1331
<                 <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-c-to-as-post-to-token-endpo" class="xref">C-to-AS: POST to Token Endpoint</a></p>
---
>                 <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-c-to-as-post-to-token-endpo" class="internal xref">C-to-AS: POST to Token Endpoint</a></p>
1318c1334
<                 <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-as-to-c-access-token" class="xref">AS-to-C: Access Token</a></p>
---
>                 <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-as-to-c-access-token" class="internal xref">AS-to-C: Access Token</a></p>
1321c1337
<                     <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="xref">3.2.1</a>.  <a href="#name-the-oscore_input_material" class="xref">The OSCORE_Input_Material</a></p>
---
>                     <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="auto internal xref">3.2.1</a>.  <a href="#name-the-oscore_input_material" class="internal xref">The OSCORE_Input_Material</a></p>
1328c1344
<             <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-client-rs-communication" class="xref">Client-RS Communication</a></p>
---
>             <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-client-rs-communication" class="internal xref">Client-RS Communication</a></p>
1331c1347
<                 <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-c-to-rs-post-to-authz-info-" class="xref">C-to-RS: POST to authz-info Endpoint</a></p>
---
>                 <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-c-to-rs-post-to-authz-info-" class="internal xref">C-to-RS: POST to authz-info Endpoint</a></p>
1334c1350
<                     <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-the-nonce-1-parameter" class="xref">The Nonce 1 Parameter</a></p>
---
>                     <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.  <a href="#name-the-nonce-1-parameter" class="internal xref">The Nonce 1 Parameter</a></p>
1337c1353
<                     <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-the-ace_client_recipientid-" class="xref">The ace_client_recipientid Parameter</a></p>
---
>                     <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="auto internal xref">4.1.2</a>.  <a href="#name-the-ace_client_recipientid-" class="internal xref">The ace_client_recipientid Parameter</a></p>
1342c1358
<                 <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-rs-to-c-201-created" class="xref">RS-to-C: 2.01 (Created)</a></p>
---
>                 <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-rs-to-c-201-created" class="internal xref">RS-to-C: 2.01 (Created)</a></p>
1345c1361
<                     <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="xref">4.2.1</a>.  <a href="#name-the-nonce-2-parameter" class="xref">The Nonce 2 Parameter</a></p>
---
>                     <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="auto internal xref">4.2.1</a>.  <a href="#name-the-nonce-2-parameter" class="internal xref">The Nonce 2 Parameter</a></p>
1348c1364
<                     <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="xref">4.2.2</a>.  <a href="#name-the-ace_server_recipientid-" class="xref">The ace_server_recipientid Parameter</a></p>
---
>                     <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="auto internal xref">4.2.2</a>.  <a href="#name-the-ace_server_recipientid-" class="internal xref">The ace_server_recipientid Parameter</a></p>
1353c1369
<                 <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-oscore-setup" class="xref">OSCORE Setup</a></p>
---
>                 <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-oscore-setup" class="internal xref">OSCORE Setup</a></p>
1356c1372
<                 <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-access-rights-verification" class="xref">Access Rights Verification</a></p>
---
>                 <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-access-rights-verification" class="internal xref">Access Rights Verification</a></p>
1361c1377
<             <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-secure-communication-with-a" class="xref">Secure Communication with AS</a></p>
---
>             <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-secure-communication-with-a" class="internal xref">Secure Communication with AS</a></p>
1364c1380
<             <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-discarding-the-security-con" class="xref">Discarding the Security Context</a></p>
---
>             <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-discarding-the-security-con" class="internal xref">Discarding the Security Context</a></p>
1367c1383
<             <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
---
>             <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
1370c1386
<             <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-privacy-considerations" class="xref">Privacy Considerations</a></p>
---
>             <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-privacy-considerations" class="internal xref">Privacy Considerations</a></p>
1373c1389
<             <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
---
>             <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
1376c1392
<                 <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-ace-profile-registry" class="xref">ACE Profile Registry</a></p>
---
>                 <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-ace-profile-registry" class="internal xref">ACE Profile Registry</a></p>
1379c1395
<                 <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-oauth-parameters-registry" class="xref">OAuth Parameters Registry</a></p>
---
>                 <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-oauth-parameters-registry" class="internal xref">OAuth Parameters Registry</a></p>
1382c1398
<                 <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="xref">9.3</a>.  <a href="#name-oauth-parameters-cbor-mappi" class="xref">OAuth Parameters CBOR Mappings Registry</a></p>
---
>                 <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-oauth-parameters-cbor-mappi" class="internal xref">OAuth Parameters CBOR Mappings Registry</a></p>
1385c1401
<                 <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="xref">9.4</a>.  <a href="#name-oscore-security-context-par" class="xref">OSCORE Security Context Parameters Registry</a></p>
---
>                 <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="auto internal xref">9.4</a>.  <a href="#name-oscore-security-context-par" class="internal xref">OSCORE Security Context Parameters Registry</a></p>
1388c1404
<                 <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="xref">9.5</a>.  <a href="#name-cwt-confirmation-methods-re" class="xref">CWT Confirmation Methods Registry</a></p>
---
>                 <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="auto internal xref">9.5</a>.  <a href="#name-cwt-confirmation-methods-re" class="internal xref">CWT Confirmation Methods Registry</a></p>
1391c1407
<                 <p id="section-toc.1-1.9.2.6.1"><a href="#section-9.6" class="xref">9.6</a>.  <a href="#name-jwt-confirmation-methods-re" class="xref">JWT Confirmation Methods Registry</a></p>
---
>                 <p id="section-toc.1-1.9.2.6.1"><a href="#section-9.6" class="auto internal xref">9.6</a>.  <a href="#name-jwt-confirmation-methods-re" class="internal xref">JWT Confirmation Methods Registry</a></p>
1394c1410
<                 <p id="section-toc.1-1.9.2.7.1"><a href="#section-9.7" class="xref">9.7</a>.  <a href="#name-expert-review-instructions" class="xref">Expert Review Instructions</a></p>
---
>                 <p id="section-toc.1-1.9.2.7.1"><a href="#section-9.7" class="auto internal xref">9.7</a>.  <a href="#name-expert-review-instructions" class="internal xref">Expert Review Instructions</a></p>
1399c1415
<             <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-references" class="xref">References</a></p>
---
>             <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-references" class="internal xref">References</a></p>
1402c1418
<                 <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
---
>                 <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
1405c1421
<                 <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
---
>                 <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
1410c1426
<             <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-profile-requirements" class="xref">Profile Requirements</a></p>
---
>             <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-profile-requirements" class="internal xref">Profile Requirements</a></p>
1413c1429
<             <p id="section-toc.1-1.12.1"><a href="#appendix-B" class="xref"></a><a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
---
>             <p id="section-toc.1-1.12.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
1416c1432
<             <p id="section-toc.1-1.13.1"><a href="#appendix-C" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
---
>             <p id="section-toc.1-1.13.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
1428c1444
<         This document specifies the <code>coap_oscore</code> profile of the ACE framework <span>[<a href="#RFC9200" class="xref">RFC9200</a>]</span>.  In this profile, a client (C) and a resource server (RS) use the Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> to communicate.  The client uses an access token, bound to a symmetric key (the proof-of-possession (PoP) key) to authorize its access to the resource server.  Note that this profile uses a symmetric-crypto-based scheme, where the symmetric secret is used as input material for keying material derivation.  In order to provide communication security and PoP, the client and resource server use Object Security for Constrained RESTful Environments (OSCORE) as defined in <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>.  Note that the PoP is not achieved through a dedicated protocol element but rather occurs after the first message exchange using OSCORE.<a href="#section-1-1" class="pilcrow">¶</a></p>
---
>         This document specifies the <code>coap_oscore</code> profile of the ACE framework <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>.  In this profile, a client (C) and a resource server (RS) use the Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span> to communicate.  The client uses an access token, bound to a symmetric key (the proof-of-possession (PoP) key) to authorize its access to the resource server.  Note that this profile uses a symmetric-crypto-based scheme, where the symmetric secret is used as input material for keying material derivation.  In order to provide communication security and PoP, the client and resource server use Object Security for Constrained RESTful Environments (OSCORE) as defined in <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.  Note that the PoP is not achieved through a dedicated protocol element but rather occurs after the first message exchange using OSCORE.<a href="#section-1-1" class="pilcrow">¶</a></p>
1430c1446
<         OSCORE specifies how to use CBOR Object Signing and Encryption (COSE) <span>[<a href="#RFC9052" class="xref">RFC9052</a>]</span> <span>[<a href="#RFC9053" class="xref">RFC9053</a>]</span> to secure CoAP messages.
---
>         OSCORE specifies how to use CBOR Object Signing and Encryption (COSE) <span>[<a href="#RFC9052" class="cite xref">RFC9052</a>]</span> <span>[<a href="#RFC9053" class="cite xref">RFC9053</a>]</span> to secure CoAP messages.
1440c1456
<     described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span>
---
>     described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span>
1443c1459
<           Certain security-related terms such as "authentication", "authorization", "confidentiality", "(data) integrity", "Message Authentication Code (MAC)", "Hash-based Message Authentication Code (HMAC)", and "verify" are taken from <span>[<a href="#RFC4949" class="xref">RFC4949</a>]</span>.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
---
>           Certain security-related terms such as "authentication", "authorization", "confidentiality", "(data) integrity", "Message Authentication Code (MAC)", "Hash-based Message Authentication Code (HMAC)", and "verify" are taken from <span>[<a href="#RFC4949" class="cite xref">RFC4949</a>]</span>.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
1445c1461
<           RESTful terminology follows HTTP <span>[<a href="#RFC9110" class="xref">RFC9110</a>]</span>.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
---
>           RESTful terminology follows HTTP <span>[<a href="#RFC9110" class="cite xref">RFC9110</a>]</span>.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
1447c1463
<           Readers are expected to be familiar with the terms and concepts defined in OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>, such as "security context" and "Recipient ID".<a href="#section-1.1-4" class="pilcrow">¶</a></p>
---
>           Readers are expected to be familiar with the terms and concepts defined in OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>, such as "security context" and "Recipient ID".<a href="#section-1.1-4" class="pilcrow">¶</a></p>
1449c1465
<           Terminology for entities in the architecture is defined in OAuth 2.0 <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>, such as client (C), resource server (RS), and authorization server (AS). It is assumed in this document that a given resource on a specific RS is associated to a unique AS.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
---
>           Terminology for entities in the architecture is defined in OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>, such as client (C), resource server (RS), and authorization server (AS). It is assumed in this document that a given resource on a specific RS is associated to a unique AS.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
1451c1467
<           Concise Binary Object Representation (CBOR) <span>[<a href="#RFC8949" class="xref">RFC8949</a>]</span> and Concise Data Definition Language (CDDL) <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span> are used in this document. CDDL predefined type names, especially "bstr" for CBOR byte strings and "tstr" for CBOR text strings, are used extensively in this document.<a href="#section-1.1-6" class="pilcrow">¶</a></p>
---
>           Concise Binary Object Representation (CBOR) <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> and Concise Data Definition Language (CDDL) <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span> are used in this document. CDDL predefined type names, especially "bstr" for CBOR byte strings and "tstr" for CBOR text strings, are used extensively in this document.<a href="#section-1.1-6" class="pilcrow">¶</a></p>
1453c1469
<           Note that the term "endpoint" is used as in <span>[<a href="#RFC9200" class="xref">RFC9200</a>]</span>, following its OAuth definition, which is to denote resources such as token and introspect at the AS and authz-info at the RS.
---
>           Note that the term "endpoint" is used as in <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, following its OAuth definition, which is to denote resources such as token and introspect at the AS and authz-info at the RS.
1455c1471
<    The CoAP definition, which is "[a]n entity participating in the CoAP protocol" <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>, is not used in this document.<a href="#section-1.1-7" class="pilcrow">¶</a></p>
---
>    The CoAP definition, which is "[a]n entity participating in the CoAP protocol" <span>[<a href="#RFC7252" class="cite xref">RFC7252</a>]</span>, is not used in this document.<a href="#section-1.1-7" class="pilcrow">¶</a></p>
1458,1459c1474,1475
<            <span><a href="https://www.rfc-editor.org/rfc/rfc8949#section-8" class="relref">Section 8</a> of [<a href="#RFC8949" class="xref">RFC8949</a>]</span> and
<            <span><a href="https://www.rfc-editor.org/rfc/rfc8610#appendix-G" class="relref">Appendix G</a> of [<a href="#RFC8610" class="xref">RFC8610</a>]</span>
---
>            <span><a href="https://rfc-editor.org/rfc/rfc8949#section-8" class="relref">Section 8</a> of [<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> and
>            <span><a href="https://rfc-editor.org/rfc/rfc8610#appendix-G" class="relref">Appendix G</a> of [<a href="#RFC8610" class="cite xref">RFC8610</a>]</span>
1463c1479
< <p id="section-1.1-9">In this document, the term "base64-encoded" refers to URL-Safe base64 encoding (see <span><a href="https://www.rfc-editor.org/rfc/rfc4648#section-5" class="relref">Section 5</a> of [<a href="#RFC4648" class="xref">RFC4648</a>]</span>) without padding.<a href="#section-1.1-9" class="pilcrow">¶</a></p>
---
> <p id="section-1.1-9">In this document, the term "base64-encoded" refers to URL-Safe base64 encoding (see <span><a href="https://rfc-editor.org/rfc/rfc4648#section-5" class="relref">Section 5</a> of [<a href="#RFC4648" class="cite xref">RFC4648</a>]</span>) without padding.<a href="#section-1.1-9" class="pilcrow">¶</a></p>
1473c1489
<         This section gives an overview of how to use the ACE Framework <span>[<a href="#RFC9200" class="xref">RFC9200</a>]</span> to secure the communication between a client and a resource server using OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>. The parameters needed by the client to negotiate the use of this profile with the AS, as well as the OSCORE setup process, are described in detail in the following sections.<a href="#section-2-1" class="pilcrow">¶</a></p>
---
>         This section gives an overview of how to use the ACE Framework <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span> to secure the communication between a client and a resource server using OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. The parameters needed by the client to negotiate the use of this profile with the AS, as well as the OSCORE setup process, are described in detail in the following sections.<a href="#section-2-1" class="pilcrow">¶</a></p>
1478c1494
<         This profile requires a client to retrieve an access token from the AS for the resource it wants to access on an RS, by sending an access token request to the token endpoint, as specified in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8" class="relref">Section 5.8</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>. The access token request and response <span class="bcp14">MUST</span> be confidentiality protected and ensure authenticity.  The use of OSCORE between the client and AS is <span class="bcp14">RECOMMENDED</span> in this profile, to reduce the number of libraries the client has to support, but other protocols fulfilling the security requirements defined in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5" class="relref">Section 5</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span> <span class="bcp14">MAY</span> alternatively be used, such as TLS <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span> or DTLS <span>[<a href="#RFC9147" class="xref">RFC9147</a>]</span>.<a href="#section-2-3" class="pilcrow">¶</a></p>
---
>         This profile requires a client to retrieve an access token from the AS for the resource it wants to access on an RS, by sending an access token request to the token endpoint, as specified in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8" class="relref">Section 5.8</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>. The access token request and response <span class="bcp14">MUST</span> be confidentiality protected and ensure authenticity.  The use of OSCORE between the client and AS is <span class="bcp14">RECOMMENDED</span> in this profile, to reduce the number of libraries the client has to support, but other protocols fulfilling the security requirements defined in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5" class="relref">Section 5</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span> <span class="bcp14">MAY</span> alternatively be used, such as TLS <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> or DTLS <span>[<a href="#RFC9147" class="cite xref">RFC9147</a>]</span>.<a href="#section-2-3" class="pilcrow">¶</a></p>
1480c1496
<         Once the client has retrieved the access token, it generates a nonce N1, as defined in this document (see <a href="#nonce1" class="xref">Section 4.1.1</a>). The client also generates its own OSCORE Recipient ID, ID1 (see <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>), for use with the keying material associated to the RS. The client posts the token, N1, and its Recipient ID to the RS using the authz-info endpoint and mechanisms specified in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8" class="relref">Section 5.8</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span> and Content-Format = application/ace+cbor. When using this profile, the communication with the authz-info endpoint is not protected, except for the update of access rights.<a href="#section-2-4" class="pilcrow">¶</a></p>
---
>         Once the client has retrieved the access token, it generates a nonce N1, as defined in this document (see <a href="#nonce1" class="auto internal xref">Section 4.1.1</a>). The client also generates its own OSCORE Recipient ID, ID1 (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>), for use with the keying material associated to the RS. The client posts the token, N1, and its Recipient ID to the RS using the authz-info endpoint and mechanisms specified in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8" class="relref">Section 5.8</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span> and Content-Format = application/ace+cbor. When using this profile, the communication with the authz-info endpoint is not protected, except for the update of access rights.<a href="#section-2-4" class="pilcrow">¶</a></p>
1482,1483c1498,1499
<         If the access token is valid, the RS replies to this request with a 2.01 (Created) response with Content-Format = application/ace+cbor, which contains a nonce N2 and its newly generated OSCORE Recipient ID, ID2, for use with the keying material associated to the client. Moreover, the server concatenates the input salt received in the token, N1, and N2 to obtain the Master Salt of the OSCORE security context (see <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3" class="relref">Section 3</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>).
<         The RS then derives the complete security context associated with the received token from the Master Salt; the OSCORE Recipient ID generated by the client (set as its OSCORE Sender ID); its own OSCORE Recipient ID; plus the parameters received in the access token from the AS, following <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.2" class="relref">Section 3.2</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>.<a href="#section-2-5" class="pilcrow">¶</a></p>
---
>         If the access token is valid, the RS replies to this request with a 2.01 (Created) response with Content-Format = application/ace+cbor, which contains a nonce N2 and its newly generated OSCORE Recipient ID, ID2, for use with the keying material associated to the client. Moreover, the server concatenates the input salt received in the token, N1, and N2 to obtain the Master Salt of the OSCORE security context (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3" class="relref">Section 3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>).
>         The RS then derives the complete security context associated with the received token from the Master Salt; the OSCORE Recipient ID generated by the client (set as its OSCORE Sender ID); its own OSCORE Recipient ID; plus the parameters received in the access token from the AS, following <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2" class="relref">Section 3.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-2-5" class="pilcrow">¶</a></p>
1494c1510
<         Instead, by using the exchanged nonces N1 and N2 as part of the Master Salt, the request to the authz-info endpoint posting the same token results in a different security context, by OSCORE construction, since even though the Master Secret, Sender ID, and Recipient ID are the same, the Master Salt is different (see <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.2.1" class="relref">Section 3.2.1</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>). If the exchanged nonces were reused, a node reusing a non-expired old token would be susceptible to on-path attackers provoking the creation of an OSCORE message using an old AEAD key and nonce.<a href="#section-2-8" class="pilcrow">¶</a></p>
---
>         Instead, by using the exchanged nonces N1 and N2 as part of the Master Salt, the request to the authz-info endpoint posting the same token results in a different security context, by OSCORE construction, since even though the Master Secret, Sender ID, and Recipient ID are the same, the Master Salt is different (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2.1" class="relref">Section 3.2.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>). If the exchanged nonces were reused, a node reusing a non-expired old token would be susceptible to on-path attackers provoking the creation of an OSCORE message using an old AEAD key and nonce.<a href="#section-2-8" class="pilcrow">¶</a></p>
1499c1515
<         An overview of the profile flow for the OSCORE profile is given in <a href="#prof-overview" class="xref">Figure 1</a>. The names of messages coincide with those of <span>[<a href="#RFC9200" class="xref">RFC9200</a>]</span> when applicable.<a href="#section-2-10" class="pilcrow">¶</a></p>
---
>         An overview of the profile flow for the OSCORE profile is given in <a href="#prof-overview" class="auto internal xref">Figure 1</a>. The names of messages coincide with those of <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span> when applicable.<a href="#section-2-10" class="pilcrow">¶</a></p>
1546c1562
<         The following subsections describe the details of the POST request and response to the token endpoint between the client and AS. <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.2" class="relref">Section 3.2</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span> defines how to derive a security context based on a shared Master Secret and a set of other parameters, established between the client and server, which the client receives from the AS in this exchange.  The PoP key included in the response from the AS <span class="bcp14">MUST</span> be used as a Master Secret in OSCORE.<a href="#section-3-1" class="pilcrow">¶</a></p>
---
>         The following subsections describe the details of the POST request and response to the token endpoint between the client and AS. <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2" class="relref">Section 3.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> defines how to derive a security context based on a shared Master Secret and a set of other parameters, established between the client and server, which the client receives from the AS in this exchange.  The PoP key included in the response from the AS <span class="bcp14">MUST</span> be used as a Master Secret in OSCORE.<a href="#section-3-1" class="pilcrow">¶</a></p>
1553c1569
<           The client-to-AS request is specified in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.1" class="relref">Section 5.8.1</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
---
>           The client-to-AS request is specified in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8.1" class="relref">Section 5.8.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
1555c1571
<           The client must send this POST request to the token endpoint over a secure channel that guarantees authentication, message integrity, and confidentiality (see <a href="#introsp" class="xref">Section 5</a>).<a href="#section-3.1-2" class="pilcrow">¶</a></p>
---
>           The client must send this POST request to the token endpoint over a secure channel that guarantees authentication, message integrity, and confidentiality (see <a href="#introsp" class="auto internal xref">Section 5</a>).<a href="#section-3.1-2" class="pilcrow">¶</a></p>
1557c1573
<           An example of such a request is shown in <a href="#ex0" class="xref">Figure 2</a>.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
---
>           An example of such a request is shown in <a href="#ex0" class="auto internal xref">Figure 2</a>.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
1560,1561c1576,1577
<           <div id="section-3.1-4.1">
< <pre class="lang-cbor-diag sourcecode">
---
>           <div class="lang-cbor-diag sourcecode" id="section-3.1-4.1">
> <pre>
1578c1594
<           If the client wants to update its access rights without changing an existing OSCORE security context, it <span class="bcp14">MUST</span> include a <code>req_cnf</code> object in its POST request to the token endpoint, with the <code>kid</code> field carrying a CBOR byte string containing the OSCORE Input Material identifier (assigned as discussed in <a href="#as-c" class="xref">Section 3.2</a>). This identifier, together with other information such as audience (see <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.1" class="relref">Section 5.8.1</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>), can be used by the AS to determine the shared secret bound to the proof-of-possession token; therefore, it <span class="bcp14">MUST</span> identify a symmetric key that was previously generated by the AS as a shared secret for the communication between the client and the RS. The AS <span class="bcp14">MUST</span> verify that the received value identifies a proof-of-possession key that has previously been issued to the requesting client. If that is not the case, the client-to-AS request <span class="bcp14">MUST</span> be declined with the error code <code>invalid_request</code> as defined in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.3" class="relref">Section 5.8.3</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
---
>           If the client wants to update its access rights without changing an existing OSCORE security context, it <span class="bcp14">MUST</span> include a <code>req_cnf</code> object in its POST request to the token endpoint, with the <code>kid</code> field carrying a CBOR byte string containing the OSCORE Input Material identifier (assigned as discussed in <a href="#as-c" class="auto internal xref">Section 3.2</a>). This identifier, together with other information such as audience (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8.1" class="relref">Section 5.8.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>), can be used by the AS to determine the shared secret bound to the proof-of-possession token; therefore, it <span class="bcp14">MUST</span> identify a symmetric key that was previously generated by the AS as a shared secret for the communication between the client and the RS. The AS <span class="bcp14">MUST</span> verify that the received value identifies a proof-of-possession key that has previously been issued to the requesting client. If that is not the case, the client-to-AS request <span class="bcp14">MUST</span> be declined with the error code <code>invalid_request</code> as defined in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8.3" class="relref">Section 5.8.3</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
1580c1596
<           An example of such a request is shown in <a href="#ex7" class="xref">Figure 3</a>.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
---
>           An example of such a request is shown in <a href="#ex7" class="auto internal xref">Figure 3</a>.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
1583,1584c1599,1600
<           <div id="section-3.1-7.1">
< <pre class="lang-cbor-diag sourcecode">
---
>           <div class="lang-cbor-diag sourcecode" id="section-3.1-7.1">
> <pre>
1611c1627
<           After verifying the POST request to the token endpoint and that the client is authorized to obtain an access token corresponding to its access token request, the AS responds as defined in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.2" class="relref">Section 5.8.2</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>. If the client request was invalid, or not authorized, the AS returns an error response as described in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.3" class="relref">Section 5.8.3</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
---
>           After verifying the POST request to the token endpoint and that the client is authorized to obtain an access token corresponding to its access token request, the AS responds as defined in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8.2" class="relref">Section 5.8.2</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>. If the client request was invalid, or not authorized, the AS returns an error response as described in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8.3" class="relref">Section 5.8.3</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
1613c1629
<           The AS can signal that the use of OSCORE is <span class="bcp14">REQUIRED</span> for a specific access token by including the <code>ace_profile</code> parameter with the value <code>coap_oscore</code> in the access token response.  This means that the client <span class="bcp14">MUST</span> use OSCORE towards all resource servers for which this access token is valid, and follow <a href="#oscore-setup" class="xref">Section 4.3</a> to derive the security context to run OSCORE.
---
>           The AS can signal that the use of OSCORE is <span class="bcp14">REQUIRED</span> for a specific access token by including the <code>ace_profile</code> parameter with the value <code>coap_oscore</code> in the access token response.  This means that the client <span class="bcp14">MUST</span> use OSCORE towards all resource servers for which this access token is valid, and follow <a href="#oscore-setup" class="auto internal xref">Section 4.3</a> to derive the security context to run OSCORE.
1630c1646
<           <li class="normal" id="section-3.2-6.3">an HMAC-based key derivation function (HKDF) algorithm <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span>. It is specified by the HMAC algorithm value; see <span><a href="https://www.rfc-editor.org/rfc/rfc9053#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC9053" class="xref">RFC9053</a>]</span>.<a href="#section-3.2-6.3" class="pilcrow">¶</a>
---
>           <li class="normal" id="section-3.2-6.3">an HMAC-based key derivation function (HKDF) algorithm <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span>. It is specified by the HMAC algorithm value; see <span><a href="https://rfc-editor.org/rfc/rfc9053#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC9053" class="cite xref">RFC9053</a>]</span>.<a href="#section-3.2-6.3" class="pilcrow">¶</a>
1638c1654
<           This data is transported in the OSCORE_Input_Material. The OSCORE_Input_Material is a CBOR map object, defined in <a href="#oscore-sec-ctx" class="xref">Section 3.2.1</a>. This object is transported in the <code>cnf</code> parameter of the access token response, as defined in <span><a href="https://www.rfc-editor.org/rfc/rfc9201#section-3.2" class="relref">Section 3.2</a> of [<a href="#RFC9201" class="xref">RFC9201</a>]</span>, as the value of a field named <code>osc</code>, which is registered in Sections <a href="#osc-cwt" class="xref">9.5</a> and <a href="#osc-jwt" class="xref">9.6</a>.<a href="#section-3.2-7" class="pilcrow">¶</a></p>
---
>           This data is transported in the OSCORE_Input_Material. The OSCORE_Input_Material is a CBOR map object, defined in <a href="#oscore-sec-ctx" class="auto internal xref">Section 3.2.1</a>. This object is transported in the <code>cnf</code> parameter of the access token response, as defined in <span><a href="https://rfc-editor.org/rfc/rfc9201#section-3.2" class="relref">Section 3.2</a> of [<a href="#RFC9201" class="cite xref">RFC9201</a>]</span>, as the value of a field named <code>osc</code>, which is registered in Sections <a href="#osc-cwt" class="auto internal xref">9.5</a> and <a href="#osc-jwt" class="auto internal xref">9.6</a>.<a href="#section-3.2-7" class="pilcrow">¶</a></p>
1640c1656
<           The AS <span class="bcp14">MAY</span> assign an identifier to the context (context identifier). This identifier is used as ID Context in the OSCORE context as described in <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>. If assigned, these parameters <span class="bcp14">MUST</span> be communicated as the <code>contextId</code> field in the OSCORE_Input_Material. The application needs to consider that this identifier is sent in the clear and may reveal information about the endpoints, as mentioned in <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-12.8" class="relref">Section 12.8</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>.<a href="#section-3.2-8" class="pilcrow">¶</a></p>
---
>           The AS <span class="bcp14">MAY</span> assign an identifier to the context (context identifier). This identifier is used as ID Context in the OSCORE context as described in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. If assigned, these parameters <span class="bcp14">MUST</span> be communicated as the <code>contextId</code> field in the OSCORE_Input_Material. The application needs to consider that this identifier is sent in the clear and may reveal information about the endpoints, as mentioned in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-12.8" class="relref">Section 12.8</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.<a href="#section-3.2-8" class="pilcrow">¶</a></p>
1645c1661
<           The OSCORE Master Secret <span class="bcp14">MUST</span> be encrypted by the authorization server so that only the resource server can decrypt it (see <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-6.1" class="relref">Section 6.1</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>). The use of a CBOR Web Token (CWT) protected with COSE_Encrypt/COSE_Encrypt0 as specified in <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span> is <span class="bcp14">RECOMMENDED</span> in this profile. If the token is a CWT, the same OSCORE_Input_Material structure defined above <span class="bcp14">MUST</span> be placed in the <code>osc</code> field of the <code>cnf</code> claim of this token.<a href="#section-3.2-10" class="pilcrow">¶</a></p>
---
>           The OSCORE Master Secret <span class="bcp14">MUST</span> be encrypted by the authorization server so that only the resource server can decrypt it (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-6.1" class="relref">Section 6.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>). The use of a CBOR Web Token (CWT) protected with COSE_Encrypt/COSE_Encrypt0 as specified in <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span> is <span class="bcp14">RECOMMENDED</span> in this profile. If the token is a CWT, the same OSCORE_Input_Material structure defined above <span class="bcp14">MUST</span> be placed in the <code>osc</code> field of the <code>cnf</code> claim of this token.<a href="#section-3.2-10" class="pilcrow">¶</a></p>
1649c1665
<           <a href="#ex1" class="xref">Figure 4</a> shows an example of an AS response. The access token has been truncated for readability.<a href="#section-3.2-12" class="pilcrow">¶</a></p>
---
>           <a href="#ex1" class="auto internal xref">Figure 4</a> shows an example of an AS response. The access token has been truncated for readability.<a href="#section-3.2-12" class="pilcrow">¶</a></p>
1652,1653c1668,1669
<           <div id="section-3.2-13.1">
< <pre class="lang-cbor-diag sourcecode">
---
>           <div class="lang-cbor-diag sourcecode" id="section-3.2-13.1">
> <pre>
1676c1692
<           <a href="#ex2" class="xref">Figure 5</a> shows an example CWT Claims Set, including the relevant OSCORE parameters in the <code>cnf</code> claim.<a href="#section-3.2-14" class="pilcrow">¶</a></p>
---
>           <a href="#ex2" class="auto internal xref">Figure 5</a> shows an example CWT Claims Set, including the relevant OSCORE parameters in the <code>cnf</code> claim.<a href="#section-3.2-14" class="pilcrow">¶</a></p>
1679,1680c1695,1696
<           <div id="section-3.2-15.1">
< <pre class="lang-cbor-diag sourcecode">
---
>           <div class="lang-cbor-diag sourcecode" id="section-3.2-15.1">
> <pre>
1701c1717
<           The same CWT Claims Set as in <a href="#ex2" class="xref">Figure 5</a>, using the value abbreviations defined in <span>[<a href="#RFC9200" class="xref">RFC9200</a>]</span> and <span>[<a href="#RFC8747" class="xref">RFC8747</a>]</span> and encoded in CBOR, is shown in <a href="#ex2-cbor" class="xref">Figure 6</a>. The bytes in hexadecimal are reported in the first column, while their corresponding CBOR meaning is reported after the <code>#</code> sign on the second column, for readability.<a href="#section-3.2-16" class="pilcrow">¶</a></p>
---
>           The same CWT Claims Set as in <a href="#ex2" class="auto internal xref">Figure 5</a>, using the value abbreviations defined in <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span> and <span>[<a href="#RFC8747" class="cite xref">RFC8747</a>]</span> and encoded in CBOR, is shown in <a href="#ex2-cbor" class="auto internal xref">Figure 6</a>. The bytes in hexadecimal are reported in the first column, while their corresponding CBOR meaning is reported after the <code>#</code> sign on the second column, for readability.<a href="#section-3.2-16" class="pilcrow">¶</a></p>
1704,1705c1720,1721
<           <div id="section-3.2-17.1">
< <pre class="lang-cbor-pretty sourcecode">
---
>           <div class="lang-cbor-pretty sourcecode" id="section-3.2-17.1">
> <pre>
1738c1754
<           <a href="#ex5" class="xref">Figure 7</a> shows an example of such an AS response. The access token has been truncated for readability.<a href="#section-3.2-19" class="pilcrow">¶</a></p>
---
>           <a href="#ex5" class="auto internal xref">Figure 7</a> shows an example of such an AS response. The access token has been truncated for readability.<a href="#section-3.2-19" class="pilcrow">¶</a></p>
1741,1742c1757,1758
<           <div id="section-3.2-20.1">
< <pre class="lang-cbor-diag sourcecode">
---
>           <div class="lang-cbor-diag sourcecode" id="section-3.2-20.1">
> <pre>
1759c1775
<           <a href="#ex6" class="xref">Figure 8</a> shows an example CWT Claims Set that contains the necessary OSCORE parameters in the <code>cnf</code> claim for the update of access rights.<a href="#section-3.2-21" class="pilcrow">¶</a></p>
---
>           <a href="#ex6" class="auto internal xref">Figure 8</a> shows an example CWT Claims Set that contains the necessary OSCORE parameters in the <code>cnf</code> claim for the update of access rights.<a href="#section-3.2-21" class="pilcrow">¶</a></p>
1762,1763c1778,1779
<           <div id="section-3.2-22.1">
< <pre class="lang-cbor-diag sourcecode">
---
>           <div class="lang-cbor-diag sourcecode" id="section-3.2-22.1">
> <pre>
1785c1801
<             An OSCORE_Input_Material is an object that represents the input material to derive an OSCORE security context, i.e., the local set of information elements necessary to carry out the cryptographic operations in OSCORE (<span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>). In particular, the OSCORE_Input_Material is defined to be serialized and transported between nodes, as specified by this document, but it can also be used by other specifications if needed. The OSCORE_Input_Material can be encoded as either a JSON object or a CBOR map. The set of common parameters that can appear in an OSCORE_Input_Material can be found in the IANA "OSCORE Security Context Parameters" registry (<a href="#sec-ctx-params-reg" class="xref">Section 9.4</a>), defined for extensibility, and the initial set of parameters defined in this document is specified below.
---
>             An OSCORE_Input_Material is an object that represents the input material to derive an OSCORE security context, i.e., the local set of information elements necessary to carry out the cryptographic operations in OSCORE (<span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>). In particular, the OSCORE_Input_Material is defined to be serialized and transported between nodes, as specified by this document, but it can also be used by other specifications if needed. The OSCORE_Input_Material can be encoded as either a JSON object or a CBOR map. The set of common parameters that can appear in an OSCORE_Input_Material can be found in the IANA "OSCORE Security Context Parameters" registry (<a href="#sec-ctx-params-reg" class="auto internal xref">Section 9.4</a>), defined for extensibility, and the initial set of parameters defined in this document is specified below.
1787c1803
<             <a href="#key-labels" class="xref">Table 1</a> provides a summary of the OSCORE_Input_Material parameters defined in this section.<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
---
>             <a href="#key-labels" class="auto internal xref">Table 1</a> provides a summary of the OSCORE_Input_Material parameters defined in this section.<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
1830c1846
<                   <span>[<a href="#COSE.Algorithms" class="xref">COSE.Algorithms</a>]</span> values (HMAC-based)</td>
---
>                   <span>[<a href="#COSE.Algorithms" class="cite xref">COSE.Algorithms</a>]</span> values (HMAC-based)</td>
1838c1854
<                   <span>[<a href="#COSE.Algorithms" class="xref">COSE.Algorithms</a>]</span> values (AEAD)</td>
---
>                   <span>[<a href="#COSE.Algorithms" class="cite xref">COSE.Algorithms</a>]</span> values (AEAD)</td>
1868c1884
<                 This parameter identifies the OSCORE version number, which is an unsigned integer. For more information about this field, see <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">Section 5.4</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>.
---
>                 This parameter identifies the OSCORE version number, which is an unsigned integer. For more information about this field, see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">Section 5.4</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.
1875c1891
<                 This parameter identifies the OSCORE Master Secret value, which is a byte string. For more information about this field, see <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>.
---
>                 This parameter identifies the OSCORE Master Secret value, which is a byte string. For more information about this field, see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.
1882,1883c1898,1899
<                 This parameter identifies the OSCORE HKDF Algorithm. For more information about this field, see <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>.
<                 The values used <span class="bcp14">MUST</span> be registered in the IANA "COSE Algorithms" registry (see <span>[<a href="#COSE.Algorithms" class="xref">COSE.Algorithms</a>]</span>) and <span class="bcp14">MUST</span> be HMAC-based HKDF algorithms (see <span><a href="https://www.rfc-editor.org/rfc/rfc9053#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC9053" class="xref">RFC9053</a>]</span>). The value can be either the integer or the text-string value of the HMAC-based HKDF algorithm in the "COSE Algorithms" registry.
---
>                 This parameter identifies the OSCORE HKDF Algorithm. For more information about this field, see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.
>                 The values used <span class="bcp14">MUST</span> be registered in the IANA "COSE Algorithms" registry (see <span>[<a href="#COSE.Algorithms" class="cite xref">COSE.Algorithms</a>]</span>) and <span class="bcp14">MUST</span> be HMAC-based HKDF algorithms (see <span><a href="https://rfc-editor.org/rfc/rfc9053#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC9053" class="cite xref">RFC9053</a>]</span>). The value can be either the integer or the text-string value of the HMAC-based HKDF algorithm in the "COSE Algorithms" registry.
1890,1891c1906,1907
<                 This parameter identifies the OSCORE AEAD Algorithm. For more information about this field, see <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>.
<                 The values used <span class="bcp14">MUST</span> be registered in the IANA "COSE Algorithms" registry (see <span>[<a href="#COSE.Algorithms" class="xref">COSE.Algorithms</a>]</span>) and <span class="bcp14">MUST</span> be AEAD algorithms. The value can be either the integer or the text-string value of the HMAC-based HKDF algorithm in the "COSE Algorithms" registry.
---
>                 This parameter identifies the OSCORE AEAD Algorithm. For more information about this field, see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.
>                 The values used <span class="bcp14">MUST</span> be registered in the IANA "COSE Algorithms" registry (see <span>[<a href="#COSE.Algorithms" class="cite xref">COSE.Algorithms</a>]</span>) and <span class="bcp14">MUST</span> be AEAD algorithms. The value can be either the integer or the text-string value of the HMAC-based HKDF algorithm in the "COSE Algorithms" registry.
1898c1914
<                 This parameter identifies an input to the OSCORE Master Salt value, which is a byte string. For more information about this field, see <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>.
---
>                 This parameter identifies an input to the OSCORE Master Salt value, which is a byte string. For more information about this field, see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.
1905c1921
<                 This parameter identifies the security context as a byte string. This identifier is used as OSCORE ID Context. For more information about this field, see <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>.
---
>                 This parameter identifies the security context as a byte string. This identifier is used as OSCORE ID Context. For more information about this field, see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>.
1912c1928
<             An example of JSON OSCORE_Input_Material is given in <a href="#JSON-osc" class="xref">Figure 9</a>.<a href="#section-3.2.1-4" class="pilcrow">¶</a></p>
---
>             An example of JSON OSCORE_Input_Material is given in <a href="#JSON-osc" class="auto internal xref">Figure 9</a>.<a href="#section-3.2.1-4" class="pilcrow">¶</a></p>
1915,1916c1931,1932
<             <div id="section-3.2.1-5.1">
< <pre class="lang-json sourcecode">
---
>             <div class="lang-json sourcecode" id="section-3.2.1-5.1">
> <pre>
1929c1945
<             The CDDL grammar describing the CBOR OSCORE_Input_Material is shown in <a href="#CDDL-osc" class="xref">Figure 10</a>.<a href="#section-3.2.1-6" class="pilcrow">¶</a></p>
---
>             The CDDL grammar describing the CBOR OSCORE_Input_Material is shown in <a href="#CDDL-osc" class="auto internal xref">Figure 10</a>.<a href="#section-3.2.1-6" class="pilcrow">¶</a></p>
1932,1933c1948,1949
<             <div id="section-3.2.1-7.1">
< <pre class="lang-cddl sourcecode">
---
>             <div class="lang-cddl sourcecode" id="section-3.2.1-7.1">
> <pre>
1962c1978
<         The following subsections describe the details of the POST request and response to the authz-info endpoint between the client and RS. The client generates a nonce N1 and an identifier ID1 that is unique in the sets of its own Recipient IDs and posts them together with the token that includes the materials (e.g., OSCORE parameters) received from the AS to the RS. The RS then generates a nonce N2 and an identifier ID2 that is unique in the sets of its own Recipient IDs and uses <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.2" class="relref">Section 3.2</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span> to derive a security context based on a shared Master Secret, the two exchanged nonces, and the two identifiers, established between the client and server. The exchanged nonces and identifiers are encoded as a CBOR byte string if CBOR is used and as a base64 string if JSON is used. This security context is used to protect all future communication between the client and RS using OSCORE, as long as the access token is valid.<a href="#section-4-1" class="pilcrow">¶</a></p>
---
>         The following subsections describe the details of the POST request and response to the authz-info endpoint between the client and RS. The client generates a nonce N1 and an identifier ID1 that is unique in the sets of its own Recipient IDs and posts them together with the token that includes the materials (e.g., OSCORE parameters) received from the AS to the RS. The RS then generates a nonce N2 and an identifier ID2 that is unique in the sets of its own Recipient IDs and uses <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2" class="relref">Section 3.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> to derive a security context based on a shared Master Secret, the two exchanged nonces, and the two identifiers, established between the client and server. The exchanged nonces and identifiers are encoded as a CBOR byte string if CBOR is used and as a base64 string if JSON is used. This security context is used to protect all future communication between the client and RS using OSCORE, as long as the access token is valid.<a href="#section-4-1" class="pilcrow">¶</a></p>
1979c1995
<           The client <span class="bcp14">MUST</span> use CoAP and the authorization information resource as described in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.1" class="relref">Section 5.8.1</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span> to transport the token, N1, and ID1 to the RS.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
---
>           The client <span class="bcp14">MUST</span> use CoAP and the authorization information resource as described in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8.1" class="relref">Section 5.8.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span> to transport the token, N1, and ID1 to the RS.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
1981,1982c1997,1998
<           Note that the use of the payload and the Content-Format is different from what is described in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.1" class="relref">Section 5.8.1</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>, which only transports the token without any CBOR wrapping. In this profile, the client <span class="bcp14">MUST</span> wrap the token, N1, and ID1 in a CBOR map.
< The client <span class="bcp14">MUST</span> use the Content-Format application/ace+cbor defined in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-8.16" class="relref">Section 8.16</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>. The client <span class="bcp14">MUST</span> include the access token using the <code>access_token</code> parameter; N1 using the <code>nonce1</code> parameter defined in <a href="#nonce1" class="xref">Section 4.1.1</a>; and ID1 using the <code>ace_client_recipientid</code> parameter defined in <a href="#id1" class="xref">Section 4.1.2</a>.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
---
>           Note that the use of the payload and the Content-Format is different from what is described in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8.1" class="relref">Section 5.8.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, which only transports the token without any CBOR wrapping. In this profile, the client <span class="bcp14">MUST</span> wrap the token, N1, and ID1 in a CBOR map.
> The client <span class="bcp14">MUST</span> use the Content-Format application/ace+cbor defined in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-8.16" class="relref">Section 8.16</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>. The client <span class="bcp14">MUST</span> include the access token using the <code>access_token</code> parameter; N1 using the <code>nonce1</code> parameter defined in <a href="#nonce1" class="auto internal xref">Section 4.1.1</a>; and ID1 using the <code>ace_client_recipientid</code> parameter defined in <a href="#id1" class="auto internal xref">Section 4.1.2</a>.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
1990c2006
<           <a href="#ex3" class="xref">Figure 11</a> shows an example of the request sent from the client to the RS. The access token has been truncated for readability.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
---
>           <a href="#ex3" class="auto internal xref">Figure 11</a> shows an example of the request sent from the client to the RS. The access token has been truncated for readability.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
1993,1994c2009,2010
<           <div id="section-4.1-9.1">
< <pre class="lang-cbor-diag sourcecode">
---
>           <div class="lang-cbor-diag sourcecode" id="section-4.1-9.1">
> <pre>
2013c2029
<           If the client has already posted a valid token, has already established a security association with the RS, and wants to update its access rights, the client can do so by posting the new token (retrieved from the AS and containing the update of access rights) to the /authz-info endpoint. The client <span class="bcp14">MUST</span> protect the request using the OSCORE security context established during the first token exchange. The client <span class="bcp14">MUST</span> only send the <code>access_token</code> field in the CBOR map in the payload; no nonce or identifier is sent. After proper verification (see <a href="#rs-c" class="xref">Section 4.2</a>), the RS will replace the old token with the new one, maintaining the same security context.<a href="#section-4.1-10" class="pilcrow">¶</a></p>
---
>           If the client has already posted a valid token, has already established a security association with the RS, and wants to update its access rights, the client can do so by posting the new token (retrieved from the AS and containing the update of access rights) to the /authz-info endpoint. The client <span class="bcp14">MUST</span> protect the request using the OSCORE security context established during the first token exchange. The client <span class="bcp14">MUST</span> only send the <code>access_token</code> field in the CBOR map in the payload; no nonce or identifier is sent. After proper verification (see <a href="#rs-c" class="auto internal xref">Section 4.2</a>), the RS will replace the old token with the new one, maintaining the same security context.<a href="#section-4.1-10" class="pilcrow">¶</a></p>
2022c2038
<    JSON-based interactions. This parameter is registered in <a href="#iana-nonces-ids" class="xref">Section 9.2</a>.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
---
>    JSON-based interactions. This parameter is registered in <a href="#iana-nonces-ids" class="auto internal xref">Section 9.2</a>.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
2033c2049
<    JSON-based interactions. This parameter is registered in <a href="#iana-nonces-ids" class="xref">Section 9.2</a>.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
---
>    JSON-based interactions. This parameter is registered in <a href="#iana-nonces-ids" class="auto internal xref">Section 9.2</a>.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
2044c2060
<           The RS <span class="bcp14">MUST</span> follow the procedures defined in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.1" class="relref">Section 5.8.1</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>: the RS must verify the validity of the token. If the token is valid, the RS must respond to the POST request with 2.01 (Created).
---
>           The RS <span class="bcp14">MUST</span> follow the procedures defined in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8.1" class="relref">Section 5.8.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>: the RS must verify the validity of the token. If the token is valid, the RS must respond to the POST request with 2.01 (Created).
2046c2062
<           The RS may make an introspection request (see <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.9.1" class="relref">Section 5.9.1</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>) to validate the token before responding to the POST request to the authz-info endpoint.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
---
>           The RS may make an introspection request (see <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.9.1" class="relref">Section 5.9.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>) to validate the token before responding to the POST request to the authz-info endpoint.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
2048c2064
<           Additionally, the RS <span class="bcp14">MUST</span> generate a nonce N2 that is very unlikely to have been previously used with the same input keying material and its own Recipient ID, ID2. The RS makes sure that ID2 does not collide with any of its Recipient IDs. The RS <span class="bcp14">MUST</span> ensure that ID2 is different from the value received in the <code>ace_client_recipientid</code> parameter. The RS sends N2 and ID2 within the 2.01 (Created) response. The payload of the 2.01 (Created) response <span class="bcp14">MUST</span> be a CBOR map containing the <code>nonce2</code> parameter defined in <a href="#nonce2" class="xref">Section 4.2.1</a>, set to N2, and the <code>ace_server_recipientid</code> parameter defined in <a href="#id2" class="xref">Section 4.2.2</a>, set to ID2. The use of a 64-bit long random number as the nonce's value is <span class="bcp14">RECOMMENDED</span> in this profile.
---
>           Additionally, the RS <span class="bcp14">MUST</span> generate a nonce N2 that is very unlikely to have been previously used with the same input keying material and its own Recipient ID, ID2. The RS makes sure that ID2 does not collide with any of its Recipient IDs. The RS <span class="bcp14">MUST</span> ensure that ID2 is different from the value received in the <code>ace_client_recipientid</code> parameter. The RS sends N2 and ID2 within the 2.01 (Created) response. The payload of the 2.01 (Created) response <span class="bcp14">MUST</span> be a CBOR map containing the <code>nonce2</code> parameter defined in <a href="#nonce2" class="auto internal xref">Section 4.2.1</a>, set to N2, and the <code>ace_server_recipientid</code> parameter defined in <a href="#id2" class="auto internal xref">Section 4.2.2</a>, set to ID2. The use of a 64-bit long random number as the nonce's value is <span class="bcp14">RECOMMENDED</span> in this profile.
2050c2066
<    The RS <span class="bcp14">MUST</span> use the Content-Format application/ace+cbor defined in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-8.16" class="relref">Section 8.16</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
---
>    The RS <span class="bcp14">MUST</span> use the Content-Format application/ace+cbor defined in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-8.16" class="relref">Section 8.16</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
2052c2068
<           <a href="#ex4" class="xref">Figure 12</a> shows an example of the response sent from the RS to the client.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
---
>           <a href="#ex4" class="auto internal xref">Figure 12</a> shows an example of the response sent from the RS to the client.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
2055,2056c2071,2072
<           <div id="section-4.2-4.1">
< <pre class="lang-cbor-diag sourcecode">
---
>           <div class="lang-cbor-diag sourcecode" id="section-4.2-4.1">
> <pre>
2071c2087
<           As specified in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.3" class="relref">Section 5.8.3</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>, the RS must notify the client with an error response with code 4.01 (Unauthorized) for any long running request before terminating the session, when the access token expires.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
---
>           As specified in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8.3" class="relref">Section 5.8.3</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, the RS must notify the client with an error response with code 4.01 (Unauthorized) for any long running request before terminating the session, when the access token expires.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
2075c2091
<           As specified in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.1" class="relref">Section 5.8.1</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>, when receiving an updated access token with updated authorization information from the client (see <a href="#c-as" class="xref">Section 3.1</a>), it is recommended that the RS overwrites the previous token; that is, only the latest authorization information in the token received by the RS is valid. This simplifies the process needed by the RS to keep track of authorization information for a given client.<a href="#section-4.2-7" class="pilcrow">¶</a></p>
---
>           As specified in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8.1" class="relref">Section 5.8.1</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>, when receiving an updated access token with updated authorization information from the client (see <a href="#c-as" class="auto internal xref">Section 3.1</a>), it is recommended that the RS overwrites the previous token; that is, only the latest authorization information in the token received by the RS is valid. This simplifies the process needed by the RS to keep track of authorization information for a given client.<a href="#section-4.2-7" class="pilcrow">¶</a></p>
2084c2100
<    JSON-based interactions. This parameter is registered in <a href="#iana-nonces-ids" class="xref">Section 9.2</a><a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
---
>    JSON-based interactions. This parameter is registered in <a href="#iana-nonces-ids" class="auto internal xref">Section 9.2</a><a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
2095c2111
<    JSON-based interactions. This parameter is registered in <a href="#iana-nonces-ids" class="xref">Section 9.2</a><a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
---
>    JSON-based interactions. This parameter is registered in <a href="#iana-nonces-ids" class="auto internal xref">Section 9.2</a><a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
2106c2122
<           Once the 2.01 (Created) response is received from the RS, following the POST request to authz-info endpoint, the client <span class="bcp14">MUST</span> extract the bstr nonce N2 from the <code>nonce2</code> parameter in the CBOR map in the payload of the response. Then, the client <span class="bcp14">MUST</span> set the Master Salt of the security context created to communicate with the RS to the concatenation of salt, N1, and N2 in this order: Master Salt = salt | N1 | N2, where | denotes byte string concatenation, salt is the CBOR byte string received from the AS in <a href="#as-c" class="xref">Section 3.2</a>, and N1 and N2 are the two nonces encoded as CBOR byte strings.  An example of Master Salt construction using CBOR encoding is given in <a href="#ms-ex" class="xref">Figure 13</a>.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
---
>           Once the 2.01 (Created) response is received from the RS, following the POST request to authz-info endpoint, the client <span class="bcp14">MUST</span> extract the bstr nonce N2 from the <code>nonce2</code> parameter in the CBOR map in the payload of the response. Then, the client <span class="bcp14">MUST</span> set the Master Salt of the security context created to communicate with the RS to the concatenation of salt, N1, and N2 in this order: Master Salt = salt | N1 | N2, where | denotes byte string concatenation, salt is the CBOR byte string received from the AS in <a href="#as-c" class="auto internal xref">Section 3.2</a>, and N1 and N2 are the two nonces encoded as CBOR byte strings.  An example of Master Salt construction using CBOR encoding is given in <a href="#ms-ex" class="auto internal xref">Figure 13</a>.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
2109,2110c2125,2126
<           <div id="section-4.3-2.1">
< <pre class="sourcecode">
---
>           <div class="sourcecode" id="section-4.3-2.1">
> <pre>
2130c2146
<           If JSON is used instead of CBOR, the Master Salt of the security context is the base64 encoding of the concatenation of the same parameters, each of them prefixed by their size, encoded in 1 byte. When using JSON, the nonces and input salt have a maximum size of 255 bytes. An example of Master Salt construction using base64 encoding is given in <a href="#ms-ex-2" class="xref">Figure 14</a>.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
---
>           If JSON is used instead of CBOR, the Master Salt of the security context is the base64 encoding of the concatenation of the same parameters, each of them prefixed by their size, encoded in 1 byte. When using JSON, the nonces and input salt have a maximum size of 255 bytes. An example of Master Salt construction using base64 encoding is given in <a href="#ms-ex-2" class="auto internal xref">Figure 14</a>.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
2133,2134c2149,2150
<           <div id="section-4.3-4.1">
< <pre class="sourcecode">
---
>           <div class="sourcecode" id="section-4.3-4.1">
> <pre>
2151c2167
<            The client <span class="bcp14">MUST</span> set the Sender ID to the <code>ace_server_recipientid</code> received in <a href="#rs-c" class="xref">Section 4.2</a> and set the Recipient ID to the <code>ace_client_recipientid</code> sent in <a href="#c-rs" class="xref">Section 4.1</a>. The client <span class="bcp14">MUST</span> set the Master Secret from the parameter received from the AS in <a href="#as-c" class="xref">Section 3.2</a>. The client <span class="bcp14">MUST</span> set the AEAD algorithm, ID Context, HKDF, and OSCORE version from the parameters received from the AS in <a href="#as-c" class="xref">Section 3.2</a>, if present. In case an optional parameter is omitted, the default value <span class="bcp14">SHALL</span> be used as described in Sections <a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.2" class="relref">3.2</a> and <a href="https://www.rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">5.4</a> of <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>. After that, the client <span class="bcp14">MUST</span> derive the complete security context following <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.2.1" class="relref">Section 3.2.1</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>. From this point on, the client <span class="bcp14">MUST</span> use this security context to communicate with the RS when accessing the resources as specified by the authorization information.<a href="#section-4.3-5" class="pilcrow">¶</a></p>
---
>            The client <span class="bcp14">MUST</span> set the Sender ID to the <code>ace_server_recipientid</code> received in <a href="#rs-c" class="auto internal xref">Section 4.2</a> and set the Recipient ID to the <code>ace_client_recipientid</code> sent in <a href="#c-rs" class="auto internal xref">Section 4.1</a>. The client <span class="bcp14">MUST</span> set the Master Secret from the parameter received from the AS in <a href="#as-c" class="auto internal xref">Section 3.2</a>. The client <span class="bcp14">MUST</span> set the AEAD algorithm, ID Context, HKDF, and OSCORE version from the parameters received from the AS in <a href="#as-c" class="auto internal xref">Section 3.2</a>, if present. In case an optional parameter is omitted, the default value <span class="bcp14">SHALL</span> be used as described in Sections <a href="https://rfc-editor.org/rfc/rfc8613#section-3.2" class="relref">3.2</a> and <a href="https://rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">5.4</a> of <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. After that, the client <span class="bcp14">MUST</span> derive the complete security context following <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2.1" class="relref">Section 3.2.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. From this point on, the client <span class="bcp14">MUST</span> use this security context to communicate with the RS when accessing the resources as specified by the authorization information.<a href="#section-4.3-5" class="pilcrow">¶</a></p>
2153c2169
<           If any of the expected parameters are missing (e.g., any of the mandatory parameters from the AS or the RS), or if <code>ace_client_recipientid</code> equals <code>ace_server_recipientid</code> (and as a consequence, the Sender and Recipient Keys derived would be equal; see <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.3" class="relref">Section 3.3</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>), then the client <span class="bcp14">MUST</span> stop the exchange and <span class="bcp14">MUST NOT</span> derive the security context. The client <span class="bcp14">MAY</span> restart the exchange, to get the correct security material.<a href="#section-4.3-6" class="pilcrow">¶</a></p>
---
>           If any of the expected parameters are missing (e.g., any of the mandatory parameters from the AS or the RS), or if <code>ace_client_recipientid</code> equals <code>ace_server_recipientid</code> (and as a consequence, the Sender and Recipient Keys derived would be equal; see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.3" class="relref">Section 3.3</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>), then the client <span class="bcp14">MUST</span> stop the exchange and <span class="bcp14">MUST NOT</span> derive the security context. The client <span class="bcp14">MAY</span> restart the exchange, to get the correct security material.<a href="#section-4.3-6" class="pilcrow">¶</a></p>
2157c2173
<           After sending the 2.01 (Created) response, the RS <span class="bcp14">MUST</span> set the Master Salt of the security context created to communicate with the client to the concatenation of salt, N1, and N2 in the same way described above. An example of Master Salt construction using CBOR encoding is given in <a href="#ms-ex" class="xref">Figure 13</a> and using base64 encoding is given in <a href="#ms-ex-2" class="xref">Figure 14</a>. The RS <span class="bcp14">MUST</span> set the Sender ID from the <code>ace_client_recipientid</code> received in <a href="#c-rs" class="xref">Section 4.1</a> and set the Recipient ID from the <code>ace_server_recipientid</code> sent in <a href="#rs-c" class="xref">Section 4.2</a>. The RS <span class="bcp14">MUST</span> set the Master Secret from the parameter received from the AS and forwarded by the client in the access token in <a href="#c-rs" class="xref">Section 4.1</a> after validation of the token as specified in <a href="#rs-c" class="xref">Section 4.2</a>. The RS <span class="bcp14">MUST</span> set the AEAD algorithm, ID Context, HKDF, and OSCORE version from the parameters received from the AS and forwarded by the client in the access token in <a href="#c-rs" class="xref">Section 4.1</a> after validation of the token as specified in <a href="#rs-c" class="xref">Section 4.2</a>, if present. In case an optional parameter is omitted, the default value <span class="bcp14">SHALL</span> be used as described in Sections <a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.2" class="relref">3.2</a> and <a href="https://www.rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">5.4</a> of <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>. After that, the RS <span class="bcp14">MUST</span> derive the complete security context following <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-3.2.1" class="relref">Section 3.2.1</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span> and <span class="bcp14">MUST</span> associate this security context with the authorization information from the access token.<a href="#section-4.3-8" class="pilcrow">¶</a></p>
---
>           After sending the 2.01 (Created) response, the RS <span class="bcp14">MUST</span> set the Master Salt of the security context created to communicate with the client to the concatenation of salt, N1, and N2 in the same way described above. An example of Master Salt construction using CBOR encoding is given in <a href="#ms-ex" class="auto internal xref">Figure 13</a> and using base64 encoding is given in <a href="#ms-ex-2" class="auto internal xref">Figure 14</a>. The RS <span class="bcp14">MUST</span> set the Sender ID from the <code>ace_client_recipientid</code> received in <a href="#c-rs" class="auto internal xref">Section 4.1</a> and set the Recipient ID from the <code>ace_server_recipientid</code> sent in <a href="#rs-c" class="auto internal xref">Section 4.2</a>. The RS <span class="bcp14">MUST</span> set the Master Secret from the parameter received from the AS and forwarded by the client in the access token in <a href="#c-rs" class="auto internal xref">Section 4.1</a> after validation of the token as specified in <a href="#rs-c" class="auto internal xref">Section 4.2</a>. The RS <span class="bcp14">MUST</span> set the AEAD algorithm, ID Context, HKDF, and OSCORE version from the parameters received from the AS and forwarded by the client in the access token in <a href="#c-rs" class="auto internal xref">Section 4.1</a> after validation of the token as specified in <a href="#rs-c" class="auto internal xref">Section 4.2</a>, if present. In case an optional parameter is omitted, the default value <span class="bcp14">SHALL</span> be used as described in Sections <a href="https://rfc-editor.org/rfc/rfc8613#section-3.2" class="relref">3.2</a> and <a href="https://rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">5.4</a> of <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. After that, the RS <span class="bcp14">MUST</span> derive the complete security context following <span><a href="https://rfc-editor.org/rfc/rfc8613#section-3.2.1" class="relref">Section 3.2.1</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> and <span class="bcp14">MUST</span> associate this security context with the authorization information from the access token.<a href="#section-4.3-8" class="pilcrow">¶</a></p>
2159c2175
<           The RS then uses this security context to verify requests and send responses to the client using OSCORE. If OSCORE verification fails, error responses are used, as specified in <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-8" class="relref">Section 8</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>. Additionally, if OSCORE verification succeeds, the verification of access rights is performed as described in <a href="#tok-ver" class="xref">Section 4.4</a>. The RS <span class="bcp14">MUST NOT</span> use the security context after the related token has expired and <span class="bcp14">MUST</span> respond with an unprotected 4.01 (Unauthorized) error message to
---
>           The RS then uses this security context to verify requests and send responses to the client using OSCORE. If OSCORE verification fails, error responses are used, as specified in <span><a href="https://rfc-editor.org/rfc/rfc8613#section-8" class="relref">Section 8</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. Additionally, if OSCORE verification succeeds, the verification of access rights is performed as described in <a href="#tok-ver" class="auto internal xref">Section 4.4</a>. The RS <span class="bcp14">MUST NOT</span> use the security context after the related token has expired and <span class="bcp14">MUST</span> respond with an unprotected 4.01 (Unauthorized) error message to
2163c2179
<           Note that the ID Context can be assigned by the AS, communicated and set in both the RS and client after the exchange specified in this profile is executed. Subsequently, the client and RS can update their ID Context by running a mechanism such as the one defined in <span><a href="https://www.rfc-editor.org/rfc/rfc8613#appendix-B.2" class="relref">Appendix B.2</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span> if they both support it and are configured to do so. In that case, the ID Context in the OSCORE security context will not match the <code>contextId</code> parameter of the corresponding OSCORE_Input_Material. Running Appendix <a href="https://www.rfc-editor.org/rfc/rfc8613#appendix-B.2" class="relref">B.2</a> results in the keying material being updated in the security contexts of the client and RS; this same result can also be achieved by the client reposting the access token to the unprotected /authz-info endpoint at the RS, as described in <a href="#c-rs" class="xref">Section 4.1</a>, but without updating the ID Context.<a href="#section-4.3-10" class="pilcrow">¶</a></p>
---
>           Note that the ID Context can be assigned by the AS, communicated and set in both the RS and client after the exchange specified in this profile is executed. Subsequently, the client and RS can update their ID Context by running a mechanism such as the one defined in <span><a href="https://rfc-editor.org/rfc/rfc8613#appendix-B.2" class="relref">Appendix B.2</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> if they both support it and are configured to do so. In that case, the ID Context in the OSCORE security context will not match the <code>contextId</code> parameter of the corresponding OSCORE_Input_Material. Running Appendix <a href="https://rfc-editor.org/rfc/rfc8613#appendix-B.2" class="relref">B.2</a> results in the keying material being updated in the security contexts of the client and RS; this same result can also be achieved by the client reposting the access token to the unprotected /authz-info endpoint at the RS, as described in <a href="#c-rs" class="auto internal xref">Section 4.1</a>, but without updating the ID Context.<a href="#section-4.3-10" class="pilcrow">¶</a></p>
2172c2188
<           The RS <span class="bcp14">MUST</span> follow the procedures defined in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.2" class="relref">Section 5.8.2</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>: if an RS receives an OSCORE-protected request from a client, then the RS processes it according to <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>. If OSCORE verification succeeds, and the target resource
---
>           The RS <span class="bcp14">MUST</span> follow the procedures defined in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8.2" class="relref">Section 5.8.2</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>: if an RS receives an OSCORE-protected request from a client, then the RS processes it according to <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>. If OSCORE verification succeeds, and the target resource
2184c2200
<         As specified in the ACE framework (<span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.9" class="relref">Section 5.9</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>), the requesting entity (RS and/or client) and the AS communicates via the introspection or token endpoint. The use of CoAP and OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> for this communication is <span class="bcp14">RECOMMENDED</span> in this profile; other protocols fulfilling the security requirements defined in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5" class="relref">Section 5</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span> (such as HTTP and DTLS or TLS) <span class="bcp14">MAY</span> be used instead.<a href="#section-5-1" class="pilcrow">¶</a></p>
---
>         As specified in the ACE framework (<span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.9" class="relref">Section 5.9</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>), the requesting entity (RS and/or client) and the AS communicates via the introspection or token endpoint. The use of CoAP and OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> for this communication is <span class="bcp14">RECOMMENDED</span> in this profile; other protocols fulfilling the security requirements defined in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5" class="relref">Section 5</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span> (such as HTTP and DTLS or TLS) <span class="bcp14">MAY</span> be used instead.<a href="#section-5-1" class="pilcrow">¶</a></p>
2186c2202
<         If OSCORE is used, the requesting entity and the AS are expected to have preestablished security contexts in place.  How these security contexts are established is out of scope for this profile.  Furthermore, the requesting entity and the AS communicate through the introspection endpoint as specified in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.9" class="relref">Section 5.9</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span> and through the token endpoint as specified in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8" class="relref">Section 5.8</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>.<a href="#section-5-2" class="pilcrow">¶</a></p>
---
>         If OSCORE is used, the requesting entity and the AS are expected to have preestablished security contexts in place.  How these security contexts are established is out of scope for this profile.  Furthermore, the requesting entity and the AS communicate through the introspection endpoint as specified in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.9" class="relref">Section 5.9</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span> and through the token endpoint as specified in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-5.8" class="relref">Section 5.8</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>.<a href="#section-5-2" class="pilcrow">¶</a></p>
2205c2221
<         <li class="normal" id="section-6-3.4"> the client receives a new nonce in the 2.01 (Created) response (see <a href="#rs-c" class="xref">Section 4.2</a>) to a POST request to the authz-info endpoint, when reposting a (non-expired) token associated to the existing context.<a href="#section-6-3.4" class="pilcrow">¶</a>
---
>         <li class="normal" id="section-6-3.4"> the client receives a new nonce in the 2.01 (Created) response (see <a href="#rs-c" class="auto internal xref">Section 4.2</a>) to a POST request to the authz-info endpoint, when reposting a (non-expired) token associated to the existing context.<a href="#section-6-3.4" class="pilcrow">¶</a>
2215c2231
<         <li class="normal" id="section-6-5.3"> the client has successfully replaced the current security context with a newer one by posting an access token to the unprotected /authz-info endpoint at the RS, e.g., by reposting the same token, as specified in <a href="#c-rs" class="xref">Section 4.1</a>.<a href="#section-6-5.3" class="pilcrow">¶</a>
---
>         <li class="normal" id="section-6-5.3"> the client has successfully replaced the current security context with a newer one by posting an access token to the unprotected /authz-info endpoint at the RS, e.g., by reposting the same token, as specified in <a href="#c-rs" class="auto internal xref">Section 4.1</a>.<a href="#section-6-5.3" class="pilcrow">¶</a>
2229c2245
<         <span>[<a href="#RFC9200" class="xref">RFC9200</a>]</span>.  Thus, the general security
---
>         <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>.  Thus, the general security
2232c2248
<         Furthermore, the general security considerations of OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> also apply to this specific
---
>         Furthermore, the general security considerations of OSCORE <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> also apply to this specific
2235c2251
<         As previously stated, the proof of possession in this profile is performed by both parties verifying that they have established the same security context, as specified in <a href="#oscore-setup" class="xref">Section 4.3</a>, which means that both the OSCORE request and the OSCORE response passes verification.
---
>         As previously stated, the proof of possession in this profile is performed by both parties verifying that they have established the same security context, as specified in <a href="#oscore-setup" class="auto internal xref">Section 4.3</a>, which means that both the OSCORE request and the OSCORE response passes verification.
2260c2276
<         <span>[<a href="#RFC9200" class="xref">RFC9200</a>]</span>.  Thus, the general privacy
---
>         <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>.  Thus, the general privacy
2264c2280
<  <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> apply here as well.<a href="#section-8-2" class="pilcrow">¶</a></p>
---
>  <span>[<a href="#RFC8613" class="cite xref">RFC8613</a>]</span> apply here as well.<a href="#section-8-2" class="pilcrow">¶</a></p>
2272c2288
<         The identifiers used in OSCORE, negotiated between the client and RS, are privacy sensitive (see <span><a href="https://www.rfc-editor.org/rfc/rfc8613#section-12.8" class="relref">Section 12.8</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>) and could reveal information about the client, or they may be used for correlating requests from one client.<a href="#section-8-6" class="pilcrow">¶</a></p>
---
>         The identifiers used in OSCORE, negotiated between the client and RS, are privacy sensitive (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-12.8" class="relref">Section 12.8</a> of [<a href="#RFC8613" class="cite xref">RFC8613</a>]</span>) and could reveal information about the client, or they may be used for correlating requests from one client.<a href="#section-8-6" class="pilcrow">¶</a></p>
2285c2301
<         registry following the procedure specified in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-8.8" class="relref">Section 8.8</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>:<a href="#section-9.1-1" class="pilcrow">¶</a></p>
---
>         registry following the procedure specified in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-8.8" class="relref">Section 8.8</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>:<a href="#section-9.1-1" class="pilcrow">¶</a></p>
2313c2329
<         registry <span>[<a href="#IANA.OAuthParameters" class="xref">IANA.OAuthParameters</a>]</span> following the procedure specified in <span><a href="https://www.rfc-editor.org/rfc/rfc6749#section-11.2" class="relref">Section 11.2</a> of [<a href="#RFC6749" class="xref">RFC6749</a>]</span>:<a href="#section-9.2-1" class="pilcrow">¶</a></p>
---
>         registry <span>[<a href="#IANA.OAuthParameters" class="cite xref">IANA.OAuthParameters</a>]</span> following the procedure specified in <span><a href="https://rfc-editor.org/rfc/rfc6749#section-11.2" class="relref">Section 11.2</a> of [<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>:<a href="#section-9.2-1" class="pilcrow">¶</a></p>
2393c2409
<         registry following the procedure specified in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#section-8.10" class="relref">Section 8.10</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>:<a href="#section-9.3-1" class="pilcrow">¶</a></p>
---
>         registry following the procedure specified in <span><a href="https://rfc-editor.org/rfc/rfc9200#section-8.10" class="relref">Section 8.10</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>:<a href="#section-9.3-1" class="pilcrow">¶</a></p>
2474,2475c2490,2491
<           The registration procedure depends on the range of CBOR label values, following <span>[<a href="#RFC8126" class="xref">RFC8126</a>]</span>.
<           Guidelines for the experts are provided in <a href="#review" class="xref">Section 9.7</a>.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
---
>           The registration procedure depends on the range of CBOR label values, following <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>.
>           Guidelines for the experts are provided in <a href="#review" class="auto internal xref">Section 9.7</a>.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
2521c2537
<           This registry has been initially populated by the values in <a href="#key-labels" class="xref">Table 1</a>.
---
>           This registry has been initially populated by the values in <a href="#key-labels" class="auto internal xref">Table 1</a>.
2531c2547
< <p id="section-9.5-1">The following registration has been made in the "CWT Confirmation Methods" registry <span>[<a href="#IANA.CWTConfirmationMethods" class="xref">IANA.CWTConfirmationMethods</a>]</span> following the procedure specified in <span><a href="https://www.rfc-editor.org/rfc/rfc8747#section-7.2.1" class="relref">Section 7.2.1</a> of [<a href="#RFC8747" class="xref">RFC8747</a>]</span>:<a href="#section-9.5-1" class="pilcrow">¶</a></p>
---
> <p id="section-9.5-1">The following registration has been made in the "CWT Confirmation Methods" registry <span>[<a href="#IANA.CWTConfirmationMethods" class="cite xref">IANA.CWTConfirmationMethods</a>]</span> following the procedure specified in <span><a href="https://rfc-editor.org/rfc/rfc8747#section-7.2.1" class="relref">Section 7.2.1</a> of [<a href="#RFC8747" class="cite xref">RFC8747</a>]</span>:<a href="#section-9.5-1" class="pilcrow">¶</a></p>
2559c2575
<             <a href="#oscore-sec-ctx" class="xref">Section 3.2.1</a> of RFC 9203<a href="#section-9.5-2.14" class="pilcrow">¶</a>
---
>             <a href="#oscore-sec-ctx" class="auto internal xref">Section 3.2.1</a> of RFC 9203<a href="#section-9.5-2.14" class="pilcrow">¶</a>
2570c2586
< <p id="section-9.6-1">The following registration has been made in the "JWT Confirmation Methods" registry <span>[<a href="#IANA.JWTConfirmationMethods" class="xref">IANA.JWTConfirmationMethods</a>]</span> following the procedure specified in <span><a href="https://www.rfc-editor.org/rfc/rfc7800#section-6.2.1" class="relref">Section 6.2.1</a> of [<a href="#RFC7800" class="xref">RFC7800</a>]</span>:<a href="#section-9.6-1" class="pilcrow">¶</a></p>
---
> <p id="section-9.6-1">The following registration has been made in the "JWT Confirmation Methods" registry <span>[<a href="#IANA.JWTConfirmationMethods" class="cite xref">IANA.JWTConfirmationMethods</a>]</span> following the procedure specified in <span><a href="https://rfc-editor.org/rfc/rfc7800#section-6.2.1" class="relref">Section 6.2.1</a> of [<a href="#RFC7800" class="cite xref">RFC7800</a>]</span>:<a href="#section-9.6-1" class="pilcrow">¶</a></p>
2586c2602
<             <a href="#oscore-sec-ctx" class="xref">Section 3.2.1</a> of RFC 9203<a href="#section-9.6-2.8" class="pilcrow">¶</a>
---
>             <a href="#oscore-sec-ctx" class="auto internal xref">Section 3.2.1</a> of RFC 9203<a href="#section-9.6-2.8" class="pilcrow">¶</a>
2743c2759
<         This section lists the specifications of this profile based on the requirements of the framework, as requested in <span><a href="https://www.rfc-editor.org/rfc/rfc9200#appendix-C" class="relref">Appendix C</a> of [<a href="#RFC9200" class="xref">RFC9200</a>]</span>.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
---
>         This section lists the specifications of this profile based on the requirements of the framework, as requested in <span><a href="https://rfc-editor.org/rfc/rfc9200#appendix-C" class="relref">Appendix C</a> of [<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
2748c2764
<             from the one proposed in <span>[<a href="#RFC9200" class="xref">RFC9200</a>]</span>: Not specified<a href="#appendix-A-2.1" class="pilcrow">¶</a>
---
>             from the one proposed in <span>[<a href="#RFC9200" class="cite xref">RFC9200</a>]</span>: Not specified<a href="#appendix-A-2.1" class="pilcrow">¶</a>
